/** coolay-v1.0.0 MIT License By https://github.com/ninggf/coolayui */
 ;layui.define(["jquery"],function(t){"use strict";var n=layui.$;t("&install",new Vue({el:"#install",data:{step:[{title:"环境检测",name:"home"},{title:"安全码验证",name:"verify"},{title:"环境选择",name:"config"},{title:"数据库配置",name:"db"},{title:"创建管理员",name:"user"},{title:"安装",name:"install"}],requirements:window.vueData.requirements,dirs:window.vueData.dirs,page_step:window.vueData.step,page_data:window.vueData.data,status:0,current:"home",install_progress:0,tips:"",progress:{percent:0,list:[]},verify:{code:""},config:{config:"pro"},db:{type:"MYSQL",dbname:"",dbusername:"",dbpwd:"",host:"",port:""},user:{name:"",pwd:"",confirm_pwd:"",url:"backend"}},methods:{verifyNext:function(){var s=1;return this.requirements.map(function(t){t[1].pass|t[1].optional||(s=0)}),this.dirs.map(function(t){t[1].pass|t[1].optional||(s=0)}),s},go:function(t){if(t){var s=this;s.tips="",s.status=0,n("input").removeClass("tips");for(var e=0;e<s.step.length;e++)if(s.step[e].name==s.current)return s.current="next"==t?s.step[e+1].name:s.step[e-1].name,void("install"==s.current&&s.doInstall())}},removeTips:function(t){n("input."+t).removeClass("tips")},setup:function(t){var s=this,e="installer/setup",r=[];if(this.status=1,"db"==t||"user"==t){for(var i in s[t])s[t][i]||"port"==i||"host"==i||r.push("input."+i);for(;r.length;)if(n(r.shift()).addClass("tips"),0==r.length)return void(s.status=0)}"verify"==t&&(e="installer/verify"),n.post(e,"installer/setup"==e?{step:t,cfg:s[t]}:{step:t,code:s.verify.code},function(t){t&&t.status?(s.status=1,s.go("next")):(s.current=t.step,s.tips=t.msg||"tips",s.status=0)})},doInstall:function(){var a=this,p=!1,l=null;n.get({url:"installer/install",dataType:"text",xhrFields:{onprogress:function(t){var s,e=t.currentTarget.response;p=!1===p?(s=e).length:(s=e.substring(p),e.length);var r=0;if(0==(l=JSON.parse(s)).status&&(a.install_progress=-1),a.progress.list.length){for(var i=0;i<a.progress.list.length;i++){var n=a.progress.list[i];l&&n.step==l.step&&1==l.done&&(a.progress.list.splice(i,1,l),r=1)}r||a.progress.list.push(l),a.install_progress=a.progress.list[a.progress.list.length-1].percent,layui.element.progress("install-progress",a.install_progress+"%")}else a.progress.list.push(l)}}},function(t){})}},mounted:function(){if(this.page_step){for(var t in this.page_data)this.page_data[t]&&this[t]&&(this[t]=this.page_data[t]);this.current=this.page_step}}}))});