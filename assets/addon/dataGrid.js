/** wulacms-v3.0.0 MIT License By https://github.com/ninggf/wulacms */
 ;layui.define(["laytpl","laypage","form"],function(e){function t(e){this.options=d.extend(!0,{method:"GET",request:{pageName:"page",limitName:"limit"},useAdmin:!1,showError:function(e){d(this.elem).empty()},showEmpty:function(e){d(this.elem).empty()},showLoading:function(){d(this.elem).addClass(a)},hideLoading:function(){d(this.elem).removeClass(a)}},e),e.page&&(this.options.page=d.extend({},h,!0===e.page?{}:e.page)),e.loadMore&&(this.options.loadMore=d.extend({},p,!0===e.loadMore?{}:e.loadMore)),"string"==typeof this.options.data&&(this.options.url=this.options.data,this.options.data=void 0),this.init(),this.bindEvents()}var d=layui.jquery,c=layui.laytpl,o=layui.laypage,s=layui.form,r="DataGrid",a="ew-datagrid-loading",l="ew-datagrid-item",i="ew-loading",n="ew-more-end",h={limit:10,layout:["prev","page","next","skip","count","limit"]},p={first:!0,curr:1,limit:10,text:"加载更多",loadingText:"加载中...",noMoreText:"没有更多数据了~",errorText:"加载失败，请重试"};t.prototype.init=function(){var e,r=this,l=this.options,t=this.getComponents();"static"===t.$elem.css("position")&&t.$elem.css("position","relative"),l.checkAllElem&&((e=t.$checkAll.find('input[lay-filter="'+t.checkAllFilter+'"]')).next(".layui-form-checkbox").remove(),e.remove(),t.$checkAll.append(['<input type="checkbox"',' lay-filter="',t.checkAllFilter,'"',' lay-skin="primary" class="ew-datagrid-checkbox" />'].join("")),t.$checkAll.hasClass("layui-form")||t.$checkAll.addClass("layui-form"),t.$checkAll.attr("lay-filter")||t.$checkAll.attr("lay-filter",l.checkAllElem.substring(1)),s.render("checkbox",t.$checkAll.attr("lay-filter"))),l.url?l.reqData=function(e,t){l.where||(l.where={}),l.where[l.request.pageName]=e.page,l.where[l.request.limitName]=e.limit,(l.useAdmin?layui.admin:d).ajax({url:l.url,data:l.contentType&&0===l.contentType.indexOf("application/json")?JSON.stringify(l.where):l.where,headers:l.headers,type:l.method,dataType:"json",contentType:l.contentType,success:function(e){t(l.parseData?l.parseData(e):e)},error:function(e){t({code:e.status,msg:e.statusText,xhr:e})}})}:l.data&&(l.reqData=void 0,l.loadMore?(r.renderLoadMore(),r.changeLoadMore(2),r.renderBody(l.data,0,!1,!0),l.done&&l.done(l.data,1,l.data.length)):l.page?(l.page.count=l.data.length,l.page.jump=function(e,t){l.showLoading();var o=(e.curr-1)*l.page.limit,a=o+l.page.limit;a>l.data.length&&(a=l.data.length);for(var i=[],n=o;n<a;n++)i.push(l.data[n]);l.page.data=i,r.renderBody(i,(e.curr-1)*e.limit,!1,!0),l.hideLoading(),0===l.data.length&&l.showEmpty&&l.showEmpty({}),l.done&&l.done(i,e.curr,e.count)},r.renderPage()):(r.renderBody(l.data,0,!1,!0),0===l.data.length&&l.showEmpty&&l.showEmpty({}),l.done&&l.done(l.data,1,l.data.length))),l.reqData&&(l.loadMore?r.renderLoadMore().click(function(){d(this).hasClass(i)||(l.loadMore.first?l.loadMore.first=!1:l.loadMore.curr++,r.changeLoadMore(1),l.reqData({page:l.loadMore.curr,limit:l.loadMore.limit},function(e){return 0!=e.code?(r.changeLoadMore(3),void l.loadMore.curr--):(r.changeLoadMore(0),r.renderBody(e.data,(l.loadMore.curr-1)*l.loadMore.limit,1!==l.loadMore.curr),l.done&&l.done(e.data,l.loadMore.curr,e.count||e.data.length),void((!e.data||e.data.length<l.loadMore.limit)&&r.changeLoadMore(2)))}))}).trigger("click"):l.page?(l.showLoading(),l.reqData({page:1,limit:l.page.limit},function(e){return l.hideLoading(),"string"!=typeof e&&e.data?0===e.data.length?l.showEmpty&&l.showEmpty(e):(l.page.count=e.count,l.page.jump=function(t,e){e||(l.showLoading(),l.reqData({page:t.curr,limit:t.limit},function(e){return l.hideLoading(),"string"!=typeof e&&e.data?0===e.data.length?l.showEmpty&&l.showEmpty(e):(r.renderBody(e.data,(t.curr-1)*t.limit),void(l.done&&l.done(e.data,t.curr,t.count))):l.showError&&l.showError(e)}))},r.renderPage(),r.renderBody(e.data),void(l.done&&l.done(e.data,1,e.count))):l.showError&&l.showError(e)})):(l.showLoading(),l.reqData({},function(e){return l.hideLoading(),0!=e.code?l.showError&&l.showError(e):e.data&&0!==e.data.length?(r.renderBody(e.data),void(l.done&&l.done(e.data,1,e.data.length))):l.showEmpty&&l.showEmpty(e)})))},t.prototype.bindEvents=function(){function t(e){var t;(a=d(this)).hasClass(l)||(a=0<(t=a.parent("."+l)).length?t:a.parentsUntil("."+l).last().parent());var o=a.data("index"),a={elem:a,data:i.getData(o),index:o,del:function(){i.del(o)},update:function(e,t){i.update(o,e,t)}};return d.extend(a,e)}var i=this,n=this.getComponents();n.$elem.off("click.item").on("click.item",">."+l,function(){layui.event.call(this,r,"item("+n.filter+")",t.call(this,{}))}),n.$elem.off("dblclick.itemDouble").on("click.itemDouble",">."+l,function(){layui.event.call(this,r,"itemDouble("+n.filter+")",t.call(this,{}))}),n.$elem.off("click.tool").on("click.tool","[lay-event]",function(e){layui.stope(e);e=d(this);layui.event.call(this,r,"tool("+n.filter+")",t.call(this,{event:e.attr("lay-event")}))}),s.on("radio("+n.radioFilter+")",function(e){e=i.getData(e.value);e.LAY_CHECKED=!0,layui.event.call(this,r,"checkbox("+n.filter+")",{checked:!0,data:e})}),s.on("checkbox("+n.checkboxFilter+")",function(e){var t=e.elem.checked,e=i.getData(e.value);e.LAY_CHECKED=t,i.checkChooseAllCB(),layui.event.call(this,r,"checkbox("+n.filter+")",{checked:t,data:e})}),s.on("checkbox("+n.checkAllFilter+")",function(e){var t=e.elem.checked,o=d(e.elem),e=o.next(".layui-form-checkbox");if(!i.options.data||i.options.data.length<=0)return o.prop("checked",!1),void e.removeClass("layui-form-checked");n.$elem.find('input[name="'+n.checkboxFilter+'"]').each(function(){var e=d(this);e.prop("checked",t);e=e.next(".layui-form-checkbox");t?e.addClass("layui-form-checked"):e.removeClass("layui-form-checked")});for(var a=0;a<i.options.data.length;a++)i.options.data[a].LAY_CHECKED=t;layui.event.call(this,r,"checkbox("+n.filter+")",{checked:t,type:"all"})})},t.prototype.getComponents=function(){var e=this,t=d(e.options.elem),o=t.attr("lay-filter");return o||(o=e.options.elem.substring(1),t.attr("lay-filter",o)),{$elem:t,templetHtml:d(e.options.templet).html(),$page:e.options.page&&e.options.page.elem?d("#"+e.options.page.elem):void 0,$loadMore:e.options.loadMore&&e.options.loadMore.elem?d("#"+e.options.loadMore.elem):void 0,filter:o,checkboxFilter:"ew_tb_checkbox_"+o,radioFilter:"ew_tb_radio_"+o,checkAllFilter:"ew_tb_checkbox_all_"+o,$checkAll:d(e.options.checkAllElem)}},t.prototype.renderBody=function(e,t,o,a){e=e||[];var i=this.options,n=this.getComponents();t=t||0;for(var r=[],l=0;l<e.length;l++){var d=e[l];if(d.LAY_INDEX=l,d.LAY_NUMBER=l+t+1,d.LAY_CHECKBOX_ELEM=['<input type="checkbox" lay-skin="primary"',' name="',n.checkboxFilter,'"',' lay-filter="',n.checkboxFilter,'"',d.LAY_CHECKED?' checked="checked"':"",' class="ew-datagrid-checkbox"',' value="'+l+'" />'].join(""),d.LAY_RADIO_ELEM=['<input type="radio"',' name="',n.radioFilter,'"',' lay-filter="',n.radioFilter,'"',d.LAY_CHECKED?' checked="checked"':"",' class="ew-datagrid-radio"',' value="',l,'" />'].join(""),void 0===n.templetHtml)return console.error("DataGrid Error: Template ["+i.templet+"] not found");c(n.templetHtml).render(d,function(e){r.push(e)})}o?(a||(i.data=i.data.concat(e)),n.$elem.append(r.join(""))):(a||(i.data=e),n.$elem.html(r.join(""))),this.initChildren(t),s.render("checkbox",n.filter),s.render("radio",n.filter),this.checkChooseAllCB()},t.prototype.initChildren=function(o){o&&this.options.page&&this.options.page.data||(o=0),this.getComponents().$elem.children().each(function(e){var t=d(this);t.attr("data-index",e),t.attr("data-number",e+o+1),t.addClass(l)})},t.prototype.renderPage=function(){var e=this.options,t=this.getComponents();t.$elem.next(".ew-datagrid-page,.ew-datagrid-loadmore").remove(),e.page.elem="ew-datagrid-page-"+e.elem.substring(1),t.$elem.after('<div class="ew-datagrid-page '+(e.page.class||"")+'" id="'+e.page.elem+'"></div>'),o.render(e.page)},t.prototype.renderLoadMore=function(){var e=this.options,t=this.getComponents();return t.$elem.next(".ew-datagrid-page,.ew-datagrid-loadmore").remove(),e.loadMore.elem="ew-datagrid-page-"+e.elem.substring(1),t.$elem.after(['<div id="',e.loadMore.elem,'" ','class="ew-datagrid-loadmore ',e.loadMore.class||"",'">',"   <div>",'      <span class="ew-icon-loading">','         <i class="layui-icon layui-icon-loading-1 layui-anim layui-anim-rotate layui-anim-loop"></i>',"      </span>",'      <span class="ew-loadmore-text">',e.loadMore.text,"</span>","   </div>","</div>"].join("")),t.$elem.next()},t.prototype.changeLoadMore=function(e){var t=this.options,o=this.getComponents(),a=o.$loadMore.find(".ew-loadmore-text");o.$loadMore.removeClass(i+" "+n),0===e?a.html(t.loadMore.text):1===e?(a.html(t.loadMore.loadingText),o.$loadMore.addClass(i)):2===e?(a.html(t.loadMore.noMoreText),o.$loadMore.addClass(n)):a.html(t.loadMore.errorText)},t.prototype.update=function(t,e,o){var a=this,i=this.getComponents(),n=i.$elem.children('[data-index="'+t+'"]'),r=n.data("number");r-t!=1?d.extend(!0,this.options.data[r-1],e):d.extend(!0,this.options.data[t],e),2!==o&&c(i.templetHtml).render(a.getData(t),function(e){return 1===o?n.html(d(e).html()):(n.before(e).remove(),void a.initChildren(r-t-1))})},t.prototype.del=function(e){var t=this.getComponents().$elem.children('[data-index="'+e+'"]'),o=t.data("number");t.remove(),o-e!=1?this.options.data.splice(o-1,1):this.options.data.splice(e,1),this.initChildren(o-e-1)},t.prototype.getData=function(e){if(void 0===e)return this.options.data;var t=this.getComponents().$elem.children('[data-index="'+e+'"]').data("number");return t-e!=1?this.options.data[t-1]:this.options.data[e]},t.prototype.checkStatus=function(){var t=this,e=this.getComponents(),o=e.checkboxFilter,a=e.radioFilter,i=[],a=e.$elem.find('input[name="'+a+'"]');return 0<a.length?void 0===(a=a.filter(":checked").val())||(a=t.getData(a))&&i.push(a):e.$elem.find('input[name="'+o+'"]:checked').each(function(){var e=d(this).val();void 0===e||(e=t.getData(e))&&i.push(e)}),i},t.prototype.checkChooseAllCB=function(){for(var e=this.getComponents(),e=e.$checkAll.find('input[lay-filter="'+e.checkAllFilter+'"]'),t=0!==this.options.data.length,o=0;o<this.options.data.length;o++)if(!this.options.data[o].LAY_CHECKED){t=!1;break}t?(e.prop("checked",!0),e.next(".layui-form-checkbox").addClass("layui-form-checked")):(e.prop("checked",!1),e.next(".layui-form-checkbox").removeClass("layui-form-checked"))},t.prototype.reload=function(e){e&&(e.page?(this.options.page?e.page=d.extend({},this.options.page,e.page):e.page=d.extend({},h,e.page),this.options.loadMore&&(this.options.loadMore=void 0)):e.loadMore&&(this.options.loadMore?e.loadMore=d.extend({},this.options.loadMore,e.loadMore,{first:!0,curr:1}):e.loadMore=d.extend({},p,e.loadMore),this.options.page&&(this.options.page=void 0)),d.extend(!0,this.options,e)),this.init()};var m={render:function(e){return e.onItemClick&&m.onItemClick(e.elem,e.onItemClick),e.onToolBarClick&&m.onToolBarClick(e.elem,e.onToolBarClick),new t(e)},on:function(e,t){return layui.onevent.call(this,r,e,t)},onItemClick:function(e,t){return 0===e.indexOf("#")&&(e=e.substring(1)),m.on("item("+e+")",t)},onToolBarClick:function(e,t){return 0===e.indexOf("#")&&(e=e.substring(1)),m.on("tool("+e+")",t)}};m.autoRender=function(e){d(e||"[data-grid]").each(function(){try{var e=d(this),t=e.attr("id");t||(t="ew-datagrid-"+(d('[id^="ew-datagrid-"]').length+1),e.attr("id",t));var o=e.children("[data-grid-tpl]");0<o.length&&(o.attr("id",t+"-tpl"),e.after(o),(e=function(t){if(t)try{return new Function("return "+t)()}catch(e){console.error("element property data- configuration item has a syntax error: "+t)}}(e.attr("lay-data"))).elem="#"+t,e.templet="#"+t+"-tpl",m.render(e))}catch(e){console.error(e)}})},m.autoRender(),d("head").append(['<style id="ew-css-datagrid">',".ew-datagrid-loadmore, .ew-datagrid-page {","    text-align: center;","}",".ew-datagrid-loadmore {","    color: #666;","    cursor: pointer;","}",".ew-datagrid-loadmore > div {","    padding: 12px;","}",".ew-datagrid-loadmore > div:hover {","    background-color: rgba(0, 0, 0, .03);","}",".ew-datagrid-loadmore .ew-icon-loading {","    margin-right: 6px;","    display: none;","}",".ew-datagrid-loadmore.",n," {","    pointer-events: none;","}",".ew-datagrid-loadmore.",i," .ew-icon-loading {","    display: inline;","}",".",a,":before {",'    content: "\\e63d";',"    font-family: layui-icon !important;","    font-size: 32px;","    color: #C3C3C3;","    position: absolute;","    left: 50%;","    top: 50%;","    margin-left: -16px;","    margin-top: -16px;","    z-index: 999;","    -webkit-animatione: layui-rotate 1s linear;","    animation: layui-rotate 1s linear;","    -webkit-animation-iteration-count: infinite;","    animation-iteration-count: infinite;","}",".ew-datagrid-checkbox + .layui-form-checkbox {","   padding-left: 18px;","}",".ew-datagrid-radio + .layui-form-radio {","   margin: 0;","   padding: 0;","   line-height: 22px;","}",".ew-datagrid-radio + .layui-form-radio .layui-icon {","   margin-right: 0;","}","</style>"].join("")),e("dataGrid",m)});