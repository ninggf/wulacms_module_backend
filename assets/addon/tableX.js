/** wulacms-v3.0.0 MIT License By https://github.com/ninggf/wulacms */
 ;layui.define(["layer","table","laytpl","contextMenu"],function(e){var d=layui.jquery,y=layui.layer,x=layui.table,c=layui.laytpl,r=layui.contextMenu,g=layui.device(),l="tb-search",w="txField_",D={merges:function(e,t,a,o){"boolean"==typeof a&&(o=a,a=void 0);for(var s=d('[lay-filter="'+e+'"]+.layui-table-view>.layui-table-box>.layui-table-body>table').find(">tbody>tr"),n=0;n<t.length;n++)a?r(e,t[n],a[n]):r(e,t[n]);function r(e,t,a){var o=x.cache[e];if(0<o.length)for(var n=1,r=a?o[0][a]:s.eq(0).find("td").eq(t).find(".layui-table-cell").html(),i=1;i<o.length;i++){var l=a?o[i][a]:s.eq(i).find("td").eq(t).find(".layui-table-cell").html();if(l===r){if(n++,i===o.length-1){s.eq(i-n+1).find("td").eq(t).attr("rowspan",n);for(var d=1;d<n;d++)s.eq(i-d+1).find("td").eq(t).attr("del","true")}}else{s.eq(i-n).find("td").eq(t).attr("rowspan",n);for(var c=1;c<n;c++)s.eq(i-c).find("td").eq(t).attr("del","true");n=1,r=l}}}s.find('[del="true"]').remove(),void 0!==o&&!o||x.on("sort("+e+")",function(){D.merges(e,t,a,!1)})}};D.bindCtxMenu=function(e,a){var n=x.cache[e],o="#"+e+"+.layui-table-view .layui-table-body tr";d(o).bind("contextmenu",function(e){var t=d(this);return d(o).removeClass("layui-table-click"),t.addClass("layui-table-click"),t="function"==typeof a?a(n[t.data("index")],e.currentTarget):a,r.show(function e(t){if(t){for(var a=[],o=0;o<t.length;o++)a.push({icon:t[o].icon,name:t[o].name,_click:t[o].click,click:function(e,t){var a=d(t.currentTarget);this._click&&this._click(n[a.data("index")],t.currentTarget),a.removeClass("layui-table-click")},subs:e(t[o].subs)});return a}}(t),e.clientX,e.clientY,e),!1})},D.exportData=function(t){var e=t.cols,a=t.data,o=t.fileName,n=t.expType,r=(r=t.option)||{};if(g.ie)return y.msg("不支持ie导出");if("string"==typeof a){var i=y.load(2);return r.url=a,void D.loadUrl(r,function(e){y.close(i),t.data=e,D.exportData(t)})}for(var l=0;l<e.length;l++)for(var d=0;d<e[l].length;d++)void 0===e[l][d].type&&(e[l][d].type="normal"),void 0===e[l][d].hide&&(e[l][d].hide=!1);var c=[],s=[],u=[];x.eachCols(void 0,function(e,t){"normal"!==t.type||t.hide||(c.push(t.title||""),s.push(t.field||w+e))},e);for(var p=D.parseTbData(e,D.deepClone(a),!0),f=0;f<p.length;f++){for(var v=[],m=0;m<s.length;m++){var h=(h=p[f][s[m]])&&h.toString().replace(/,/g,"，");v.push(h)}u.push(v.join(","))}var b=document.createElement("a"),r={csv:"text/csv",xls:"application/vnd.ms-excel"}[n||"xls"],a=encodeURIComponent(c.join(",")+"\r\n"+u.join("\r\n"));b.href="data:"+r+";charset=utf-8,\ufeff"+a,b.download=(o||"table")+"."+(n||"xls"),document.body.appendChild(b),b.click(),document.body.removeChild(b)},D.exportDataX=function(u){layui.use("excel",function(){var e=layui.excel,t=u.cols,a=u.data,o=u.fileName,n=u.expType,r=(r=u.option)||{},n=n||"xlsx";if(a&&"string"==typeof a){var i=y.load(2);return r.url=a,void D.loadUrl(r,function(e){y.close(i),u.data=e,D.exportDataX(u)})}for(var l=0;l<t.length;l++)for(var d=0;d<t[l].length;d++)void 0===t[l][d].type&&(t[l][d].type="normal"),void 0===t[l][d].hide&&(t[l][d].hide=!1);var c={},s=[];x.eachCols(void 0,function(e,t){"normal"!==t.type||t.hide||(e=t.field||w+e,s.push(e),c[e]=t.title||"")},t);a=D.parseTbData(t,D.deepClone(a),!0),a=e.filterExportData(a,s);a.unshift(c),e.exportExcel({sheet1:a},(o||"table")+"."+n,n)})},D.exportDataBack=function(e,t,a){if(t=t||{},a&&"get"!==a.toString().toLowerCase()){var o,n='<html><body><form id="eFrom" action="'+e+'" method="'+a+'">';for(o in t)n+='<textarea name="'+o+'">'+t[o]+"</textarea>";n+="</form></body></html>",d("#exportFrame").remove(),d("body").append('<iframe id="exportFrame" style="display: none;"></iframe>');var r=document.getElementById("exportFrame").contentWindow,a=r.document;r.focus(),a.open(),a.write(n),a.close(),a.getElementById("eFrom").submit()}else{var i,l="";for(i in t)l?l+="&"+i+"="+t[i]:l="?"+i+"="+t[i];window.open(e+l)}},D.render=function(a){var e=d(a.elem).attr("lay-filter");a.autoSort=!1;var o=x.render(a);return x.on("sort("+e+")",function(e){var t=e.field,e=e.type,e=d.extend(a.where,{sort:t,order:e});o.reload({where:e,page:{curr:1}})}),o},D.renderFront=function(a){var o,n=d(a.elem).attr("lay-filter");a.autoSort=!1;for(var e,t=0;t<a.cols.length;t++)for(var r=0;r<a.cols[t].length;r++)a.cols[t][r].templet&&!a.cols[t][r].field&&(a.cols[t][r].field=w+t+"_"+r);return a.url?((e=D.deepClone(a)).data=[],e.url=void 0,(o=x.render(e)).reloadUrl=function(e){var t=D.deepClone(a);e&&(t=d.extend(t,e)),d(a.elem+"+.layui-table-view>.layui-table-box").append('<div class="layui-table-init"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></div>'),D.loadUrl(t,function(e){o.reload({url:"",data:e,page:{curr:1}}),D.putTbData(n,D.parseTbData(t.cols,e)),d("input["+l+'="'+n+'"]').val(""),window.tbX.cacheSearch[n]=void 0})},o.reloadUrl()):((o=x.render(a)).reloadData=function(e){o.reload(e),D.parseTbData(a.cols,e.data),D.putTbData(n,e.data),d("input["+l+'="'+n+'"]').val(""),window.tbX.cacheSearch[n]=void 0},D.putTbData(n,D.parseTbData(a.cols,a.data))),D.renderAllTool(o),o},D.loadUrl=function(a,o){a.response=d.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},a.response);var n=a.response,e=a.where;a.contentType&&0===a.contentType.indexOf("application/json")&&(e=JSON.stringify(e)),d.ajax({type:a.method||"get",url:a.url,contentType:a.contentType,data:e,dataType:"json",headers:a.headers||{},success:function(e){var t;"function"==typeof a.parseData&&(e=a.parseData(e)||e),e[n.statusName]!=n.statusCode?(t=e[n.msgName]||"返回的数据不符合规范，正确的成功状态码 ("+n.statusName+") 应为："+n.statusCode,y.msg(t,{icon:2})):o(e[n.dataName])},error:function(e,t){y.msg("数据接口请求异常："+t,{icon:2})}})},D.parseTbData=function(e,t,o){var n=[];x.eachCols(void 0,function(e,a){a.templet&&(e={field:a.field&&(o||0===a.field.indexOf(w))?a.field:"txField_"+e},"string"==typeof a.templet?e.templet=function(e){var t=void 0;return c(d(a.templet).html()).render(e,function(e){t=e}),t}:e.templet=a.templet,n.push(e))},e);for(var a=0;a<t.length;a++)for(var r=t[a],i=0;i<n.length;i++){var l="<div>"+n[i].templet(r)+"</div>";r[n[i].field]=d(l).not(".export-hide").text().replace(/(^\s*)|(\s*$)/g,"")}return t},D.putTbData=function(e,t){window.tbX.cache[e]=t},D.getTbData=function(e){var t=window.tbX.cache[e];return D.deepClone(t||x.cache[e])},D.filterData=function(e,t,a){for(var o,n=[],r=0;r<e.length;r++){var i=e[r];if(!o)if(t)o=t.split(",");else for(var l in o=[],i)i.hasOwnProperty(l)&&o.push(l);for(var d=0;d<o.length;d++)if(D.isContains(i[o[d]],a)){n.push(i);break}}return n},D.isContains=function(e,t){return t=t||"",(e=(e=e||"").toString().toLowerCase())===(t=t.toString().toLowerCase())||0<=e.indexOf(t)},D.renderAllTool=function(e){o(e),a(e),t(e),n(e)},D.deepClone=function(e){var t,a,o,n=D.isClass(e);if("Object"===n)t={};else{if("Array"!==n)return e;t=[]}for(a in e)e.hasOwnProperty(a)&&(o=e[a],"Object"===D.isClass(o)||"Array"===D.isClass(o)?t[a]=arguments.callee(o):t[a]=e[a]);return t},D.isClass=function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)},window.tbX||(window.tbX={}),window.tbX.cache||(window.tbX.cache={}),window.tbX.cacheSearch||(window.tbX.cacheSearch={});var t=function(n){var r=n.config.id,i=d("input["+l+'="'+r+'"]');i&&0<i.length&&(i.attr("placeholder")||i.attr("placeholder","输入关键字按回车键搜索"),i.off("keydown").on("keydown",function(e){var t,a,o;13===e.keyCode&&(t=i.attr("name"),o=i.val().replace(/(^\s*)|(\s*$)/g,""),a=y.msg("搜索中..",{icon:16,shade:.01,time:0}),e=D.getTbData(r),o=D.filterData(e,t,o),window.tbX.cacheSearch[r]=o,n.reload({url:"",data:o,page:{curr:1}}),y.close(a))}))},a=function(r){var i=r.config.id;x.on("sort("+i+")",function(e){var a=e.field,o=e.type,t=y.msg("加载中..",{icon:16,shade:.01,time:0}),n=(n=window.tbX.cacheSearch[i])||D.getTbData(i);o&&(n=n.sort(function(e,t){e=e[a],t=t[a];return"asc"===o?e===t?0:e<t?-1:1:e===t?0:e<t?1:-1})),r.reload({initSort:e,url:"",data:n,page:{curr:1}}),y.close(t)})},o=function(e){d('[tb-refresh="'+e.config.id+'"]').off("click").on("click",function(){e.reloadUrl?e.reloadUrl():e.reload({page:{curr:1}})})},n=function(o){var n=o.config.id;d('[tb-export="'+n+'"]').off("click").on("click",function(e){0<d(this).find(".tbx-dropdown-menu").length||(void 0!==e&&(e.preventDefault(),e.stopPropagation()),e='<div class="tbx-dropdown-menu">',e+='      <div class="tbx-dropdown-menu-item" data-type="check">导出选中数据</div>',e+='      <div class="tbx-dropdown-menu-item" data-type="current">导出当前页数据</div>',e+='      <div class="tbx-dropdown-menu-item" data-type="all">导出全部数据</div>',e+="   </div>",d(this).append('<div class="tbx-dropdown-menu">      <div class="tbx-dropdown-menu-item" data-type="check">导出选中数据</div>      <div class="tbx-dropdown-menu-item" data-type="current">导出当前页数据</div>      <div class="tbx-dropdown-menu-item" data-type="all">导出全部数据</div>   </div>'),d(this).addClass("tbx-dropdown-btn"),d(this).parent().css("position","relative"),d(this).parent().css("z-index","9998"),d(".tbx-dropdown-menu").off("click").on("click",".tbx-dropdown-menu-item",function(e){var t,a=d(this).data("type");"check"===a?0===(t=x.checkStatus(n)).data.length?y.msg("请选择要导出的数据",{icon:2}):(d(".tbx-dropdown-menu").remove(),D.exportData({fileName:o.config.title,cols:o.config.cols,data:t.data})):"current"===a?D.exportData({fileName:o.config.title,cols:o.config.cols,data:x.cache[n]}):"all"===a&&D.exportData({fileName:o.config.title,cols:o.config.cols,data:D.getTbData(n)}),void 0!==e&&(e.preventDefault(),e.stopPropagation())}))}),d(document).off("click.tbxDropHide").on("click.tbxDropHide",function(){d(".tbx-dropdown-menu").remove()})};d("head").append('<style id="ew-css-tbx" type="text/css">.tbx-dropdown-btn {        position: relative;   }   .tbx-dropdown-btn:hover {        opacity: 1   }   .tbx-dropdown-menu {        position: absolute;        top: 100%;        right: 0;        padding: 5px 0;        margin: 5px 0 0 0;        overflow: visible;        min-width: 110px;        background: #fff;        border-radius: 2px;        box-shadow: 0 2px 4px rgba(0, 0, 0, .12);        border: 1px solid #d2d2d2;        z-index: 9998;        cursor: default;   }   .tbx-dropdown-menu .tbx-dropdown-menu-item {        display: block;        color: #555;        font-size: 14px;        padding: 10px 15px;        text-decoration: none;        white-space: nowrap;        cursor: pointer;        user-select: none;        line-height: normal;   }   .tbx-dropdown-menu .tbx-dropdown-menu-item:hover {        background-color: #eeeeee;   }   .export-show {        display: none;   }</style>'),e("tableX",D)});