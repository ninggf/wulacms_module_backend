/** wulacms-v3.0.0 MIT License By https://github.com/ninggf/wulacms */
 ;layui.define(["jquery","layer","form","upload","util"],function(e){var w=layui.jquery,C=layui.layer,D=layui.form,U=layui.upload,j=layui.util,c=[{suffix:["ppt","pptx"],icon:"ppt"},{suffix:["doc","docx"],icon:"doc"},{suffix:["xls","xlsx"],icon:"xls"},{suffix:["pdf"],icon:"pdf"},{suffix:["html","htm"],icon:"htm"},{suffix:["txt"],icon:"txt"},{suffix:["swf","docx"],icon:"flash"},{suffix:["zip","rar","7z"],icon:"zip"},{suffix:["mp3","wav"],icon:"mp3"},{suffix:["mp4","3gp","rmvb","avi","flv"],icon:"mp4"},{suffix:["psd"],icon:"psd"},{suffix:["ttf"],icon:"ttf"},{suffix:["apk"],icon:"apk"},{suffix:["exe"],icon:"exe"},{suffix:["torrent"],icon:"bt"},{suffix:["gif","png","jpeg","jpg","bmp"],icon:"img"}],F={};F.open=function(e){var s=e.fileUrl,i=e.listUrl,o=e.where,a=e.num,t=e.onChoose,l=e.upload,c=e.dialog,n=e.menu,r=e.menuClick,f=e.response||{},d=f.dir,u=f.code,m=f.url,h=(f.smUrl,f.isDir),p=f.name,g=f.method,x=f.parseData,v=[],o=o||{};null!=a||(a=1),l=l||{},d=d||"dir",null!=u||(u=200),m=m||"url",h=h||"isDir",p=p||"name",g=g||"get",(c=c||{}).id="file-choose-dialog",c.type=1,null!=c.title||(c.title="选择文件"),c.content="",c.area||(c.area=["565px","420px"]),null!=c.shade||(c.shade=.1),c.fixed||(c.fixed=!1),c.skin||(c.skin="layer-file-choose");var y=e.success;function k(e){e=e||w("#fc-current-position").text(),w(".file-choose-dialog .file-choose-loading-group").removeClass("layui-hide"),o[d]=e,w("#file-choose-list").html(""),w.ajax({url:i,type:g,data:o,dataType:"json",success:function(e){x&&(e=x(e)),e.code==u?(v=e.data,w("#fc-btn-ok-sel").text("完成选择"),w("#file-choose-list").html(F.renderList({fileUrl:s,data:v,multi:1<a,menu:n,response:f})),D.render("checkbox")):(C.msg(e.msg,{icon:2,anim:6}),w("#file-choose-list").html(F.getErrorHtml("加载失败","layui-icon-face-cry"))),setTimeout(function(){w(".file-choose-dialog .file-choose-loading-group").addClass("layui-hide")},200)}})}function b(e){t&&t(e),C.close(w("#fc-btn-ok-sel").parents(".layui-layer").attr("id").substring(11))}c.success=function(e,i){w(e).children(".layui-layer-content").load(layui.cache.base+"fileChoose/fileChoose.html",function(){1<a||w(".file-choose-dialog").addClass("hide-bottom"),k(),w("#fc-btn-refresh").click(function(){k()}),w("#fc-btn-back").click(function(){var e=w("#fc-current-position").text();"/"!=e&&(e=(e=e.substring(0,e.lastIndexOf("/")))||"/",w("#fc-current-position").text(e),k(e))}),l.elem="#fc-btn-upload",l.data||(l.data={}),l.data.dir=function(){return w("#fc-current-position").text()},l.before=function(){C.load(2)},l.done=function(e,i,o){C.closeAll("loading"),e.code!=u?C.msg(e.msg,{icon:2}):(C.msg(e.msg,{icon:1}),e=e.dir||j.toDateString(new Date,"/yyyy/MM/dd"),w("#fc-current-position").text(e),k())},l.error=function(){C.closeAll("loading"),C.msg("上传失败",{icon:2})},U.render(l),w("#fc-btn-ok-sel").click(function(){var i=[];w('input[lay-filter="file-choose-item-ck"]:checked').each(function(){var e=w(this).parents(".file-choose-list-item").data("index");i.push(v[e])}),i.length<=0?C.msg("请选择",{icon:2,anim:6}):i.length>a?C.msg("最多只能选择"+a+"个",{icon:2,anim:6}):b(i)}),w(document).off("click.fcli").on("click.fcli",".file-choose-dialog .file-choose-list-item",function(e){var i,o=v[w(this).data("index")];o[h]?(i=w("#fc-current-position").text(),i+="/"==i?o[p]:"/"+o[p],w("#fc-current-position").text(i),k(i)):(i=w(this).find(".file-choose-oper-menu"),w(".file-choose-dialog .file-choose-oper-menu").not(i).removeClass("show"),i.toggleClass("show"),e.stopPropagation())}),w(document).off("click.fclom").on("click.fclom",".file-choose-dialog",function(e){w(".file-choose-dialog .file-choose-oper-menu").removeClass("show"),e.stopPropagation()}),D.on("checkbox(file-choose-item-ck)",function(e){var i=w('.file-choose-dialog input[lay-filter="file-choose-item-ck"]:checked').length;if(e.elem.checked){if(a<i)return C.msg("最多只能选择"+a+"个",{icon:2,anim:6}),w(e.elem).prop("checked",!1),void D.render("checkbox");w(e.elem).parents(".file-choose-list-item").addClass("active")}else w(e.elem).parents(".file-choose-list-item").removeClass("active");w("#fc-btn-ok-sel").text("完成选择"+(0<i?"("+i+")":""))}),w(document).off("click.fclic").on("click.fclic",".file-choose-dialog .file-choose-list-item-ck",function(e){e.stopPropagation()}),w(document).off("click.fclomi").on("click.fclomi",".file-choose-dialog .file-choose-oper-menu-item",function(){var e=w(this).data("event"),i=w(this).parent().parent().data("index");if("choose"==e)1<a?w(this).parent().parent().find(".layui-form-checkbox").trigger("click"):b([v[i]]);else if("preview"==e){var o=s+v[i][m];if("img"==F.getFileType(o)){for(var t=[],l=0,c=0;c<v.length;c++){var n=s+v[c][m];"img"==F.getFileType(n)&&t.push({src:n,alt:v[c][p]}),o==n&&(l=t.length-1)}C.photos({photos:{start:l,data:t},shade:.1,closeBtn:!0})}else C.confirm("这不是图片类型，可能需要下载才能预览，确定要打开吗？",{title:"温馨提示",area:"260px",shade:.1},function(e){C.close(e),window.open(o)})}else r&&r(e,v[i])}),y&&y(e,index)})},C.open(c)},F.renderList=function(e){var i=e.fileUrl,o=e.data,t=e.multi,l=e.menu,e=e.response||{},c=e.url,n=e.smUrl,s=e.isDir,a=e.name;null==i&&(i=""),null==o&&(o=[]),null==t&&(t=!1),c=c||"url",n=n||"smUrl",s=s||"isDir",a=a||"name";var r="";if(o.length<=0)r+=F.getErrorHtml("没有文件");else for(var f=0;f<o.length;f++){var d=o[f];r+='<div class="file-choose-list-item" data-index="'+f+'">';var u=i+d[n],m="";if(d[n]||(m=" img-icon",u=F.getFileIcon(d[c],d[s])),r+='   <div class="file-choose-list-item-img'+m+'" style="'+("background-image: url('"+u+"')")+'"></div>',r+='   <div class="file-choose-list-item-name" title="'+d[a]+'">'+d[a]+"</div>",!d[s]&&t&&(r+='   <div class="file-choose-list-item-ck layui-form">',r+='       <input type="checkbox" lay-skin="primary" lay-filter="file-choose-item-ck"/>',r+="   </div>"),l){if(0<l.length){r+='<div class="file-choose-oper-menu">';for(var h=0;h<l.length;h++){var p=l[h];r+='<div class="file-choose-oper-menu-item" data-event="'+p.event+'">'+p.name+"</div>"}r+="</div>"}}else r+='<div class="file-choose-oper-menu">',r+='   <div class="file-choose-oper-menu-item" data-event="preview">预览</div>',r+='   <div class="file-choose-oper-menu-item" data-event="choose">选择</div>',r+="</div>";r+="</div>"}return r},F.getErrorHtml=function(e,i){var o="";return o+='<div class="file-choose-empty">',o+='   <i class="layui-icon '+(i=i||"layui-icon-face-surprised")+'"></i>',o+="   <p>"+e+"</p>",o+="</div>"},F.getFileIcon=function(e,i){e=i?"dir":F.getFileType(e);return layui.cache.base+"fileChoose/img/"+e+".png"},F.getFileType=function(e){for(var i="file",o=e.substring(e.lastIndexOf(".")+1),t=0;t<c.length;t++)for(var l=0;l<c[t].suffix.length;l++)if(o.toLowerCase()==c[t].suffix[l]){i=c[t].icon;break}return i},w("body").append("<style>.layer-file-choose { max-width: 100%;}@media screen and (max-width:768px){.layer-file-choose{max-width:98%;max-width:-moz-calc(100% - 30px);max-width:-webkit-calc(100% - 30px);max-width:calc(100% - 30px);left:0!important;right:0!important;margin:auto!important;margin-bottom:15px!important}}</style>"),e("fileChoose",F)});