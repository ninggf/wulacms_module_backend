/** wulacms-v3.0.0 MIT License By https://github.com/ninggf/wulacms */
 ;layui.define(["layer","element","admin"],function(a){var l=layui.jquery,t=layui.layer,o=layui.element,u=layui.admin,s=u.setter,i=".layui-layout-admin>.layui-header",n=".layui-layout-admin>.layui-side>.layui-side-scroll",r=".layui-layout-admin>.layui-body",d=r+">.layui-tab",m=r+">.layui-body-header",c="admin-pagetabs",e="admin-side-nav",h={},y=!1,b={homeUrl:void 0,mTabPosition:void 0,mTabList:[],loadView:function(a){if(!a.menuPath)return t.msg("url不能为空",{icon:2,anim:6});if(s.pageTabs){var e;if(l(d+">.layui-tab-title>li").each(function(){l(this).attr("lay-id")===a.menuPath&&(e=!0)}),!e){if(b.mTabList.length+1>=s.maxTabNum)return t.msg("最多打开"+s.maxTabNum+"个选项卡",{icon:2,anim:6}),u.activeNav(b.mTabPosition);y=!0,o.tabAdd(c,{id:a.menuPath,title:'<span class="title">'+(a.menuName||"")+"</span>",content:'<iframe class="admin-iframe" lay-id="'+a.menuPath+'" src="'+a.menuPath+'" onload="layui.index.hideLoading(this);" frameborder="0"></iframe>'}),u.showLoading({elem:l('iframe[lay-id="'+a.menuPath+'"]').parent(),size:""}),a.menuPath!==b.homeUrl&&b.mTabList.push(a),s.cacheTab&&u.putTempData("indexTabs",b.mTabList)}a.noChange||o.tabChange(c,a.menuPath),a.refer&&((i=u.getTempData("menuRefers")||{})[a.menuPath]=[a.refer,a.reload],u.putTempData("menuRefers",i))}else{u.activeNav(a.menuPath);var i=l(r+">div>.admin-iframe");if(0===i.length?(l(r).html(['<div class="layui-body-header">','   <span class="layui-body-header-title"></span>','   <span class="layui-breadcrumb pull-right" lay-filter="admin-body-breadcrumb" style="visibility: visible;"></span>',"</div>",'<div style="-webkit-overflow-scrolling: touch;">','   <iframe class="admin-iframe" lay-id="',a.menuPath,'" src="',a.menuPath,'"','      onload="layui.index.hideLoading(this);" frameborder="0"></iframe>',"</div>"].join("")),u.showLoading({elem:l('iframe[lay-id="'+a.menuPath+'"]').parent(),size:""})):(u.showLoading({elem:i.parent(),size:""}),i.attr("lay-id",a.menuPath).attr("src",a.menuPath)),l('[lay-filter="admin-body-breadcrumb"]').html(b.getBreadcrumbHtml(a.menuPath)),b.mTabList.splice(0,b.mTabList.length),a.menuPath===b.homeUrl?(b.mTabPosition=void 0,b.setTabTitle(l(a.menuName).text()||l(n+' [lay-href="'+b.homeUrl+'"]').text()||"主页")):(b.mTabPosition=a.menuPath,b.mTabList.push(a),b.setTabTitle(a.menuName)),!s.cacheTab)return;u.putTempData("indexTabs",b.mTabList),u.putTempData("tabPosition",b.mTabPosition)}u.getPageWidth()<=768&&u.flexible(!0)},loadHome:function(a){var e=u.getTempData("indexTabs"),i=u.getTempData("tabPosition"),t=(void 0===a.loadSetting||a.loadSetting)&&s.cacheTab&&e&&0<e.length;if(b.homeUrl=a.menuPath,a.noChange=!!i&&t,!s.pageTabs&&t||b.loadView(a),t)for(var n=0;n<e.length;n++)e[n].noChange=e[n].menuPath!==i,e[n].noChange&&(!s.pageTabs||a.onlyLast)||b.loadView(e[n]);u.removeLoading(void 0,!1)},openTab:function(a){if(window!==top&&!u.isTop()&&top.layui&&top.layui.index)return top.layui.index.openTab(a);a.end&&(h[a.url]=a.end),b.loadView({menuPath:a.url,menuName:a.title,refer:a.refer,reload:a.reload})},closeTab:function(a){if(window!==top&&!u.isTop()&&top.layui&&top.layui.index)return top.layui.index.closeTab(a);o.tabDelete(c,a)},setTabCache:function(a){return window!==top&&!u.isTop()&&top.layui&&top.layui.index?top.layui.index.setTabCache(a):(u.putSetting("cacheTab",a),a?(u.putTempData("indexTabs",b.mTabList),void u.putTempData("tabPosition",b.mTabPosition)):b.clearTabCache())},clearTabCache:function(){u.putTempData("indexTabs",null),u.putTempData("tabPosition",null),u.putTempData("menuRefers",null)},setTabTitle:function(a,e){if(window!==top&&!u.isTop()&&top.layui&&top.layui.index)return top.layui.index.setTabTitle(a,e);s.pageTabs?(e=e||l(d+">.layui-tab-title>li.layui-this").attr("lay-id"))&&l(d+'>.layui-tab-title>li[lay-id="'+e+'"] .title').html(a||""):a?(l(m+">.layui-body-header-title").html(a),l(m).addClass("show"),l(i).css("box-shadow","0 1px 0 0 rgba(0, 0, 0, .03)")):(l(m).removeClass("show"),l(i).css("box-shadow",""))},setTabTitleHtml:function(a){if(window!==top&&!u.isTop()&&top.layui&&top.layui.index)return top.layui.index.setTabTitleHtml(a);if(!s.pageTabs){if(!a)return l(m).removeClass("show");l(m).html(a),l(m).addClass("show")}},getBreadcrumb:function(a){a=a||l(r+">div>.admin-iframe").attr("lay-id");var e=[],i=l(n).find('[lay-href="'+a+'"]');for(0<i.length&&e.push(i.text().replace(/(^\s*)|(\s*$)/g,""));0!==(i=i.parent("dd").parent("dl").prev("a")).length;)e.unshift(i.text().replace(/(^\s*)|(\s*$)/g,""));return e},getBreadcrumbHtml:function(a){for(var e=b.getBreadcrumb(a),i=a===b.homeUrl?"":'<a ew-href="'+b.homeUrl+'">首页</a>',t=0;t<e.length-1;t++)i&&(i+='<span lay-separator="">/</span>'),i+="<a><cite>"+e[t]+"</cite></a>";return i},hideLoading:function(a){"string"!=typeof a&&(a=l(a).attr("lay-id")),u.removeLoading(l('iframe[lay-id="'+a+'"],'+r+" iframe[lay-id]").parent(),!1)}},f=".layui-layout-admin .site-mobile-shade";0===l(f).length&&l(".layui-layout-admin").append('<div class="site-mobile-shade"></div>'),l(f).click(function(){u.flexible(!0)}),s.pageTabs&&0===l(d).length&&(l(r).html(['<div class="layui-tab" lay-allowClose="true" lay-filter="',c,'" lay-autoRefresh="',"true"==s.tabAutoRefresh,'">','   <ul class="layui-tab-title"></ul><div class="layui-tab-content"></div>',"</div>",'<div class="layui-icon admin-tabs-control layui-icon-prev" ew-event="leftPage"></div>','<div class="layui-icon admin-tabs-control layui-icon-next" ew-event="rightPage"></div>','<div class="layui-icon admin-tabs-control layui-icon-down">','   <ul class="layui-nav" lay-filter="admin-pagetabs-nav">','      <li class="layui-nav-item" lay-unselect>','         <dl class="layui-nav-child layui-anim-fadein">','            <dd ew-event="closeThisTabs" lay-unselect><a>关闭当前标签页</a></dd>','            <dd ew-event="closeOtherTabs" lay-unselect><a>关闭其它标签页</a></dd>','            <dd ew-event="closeAllTabs" lay-unselect><a>关闭全部标签页</a></dd>',"         </dl>","      </li>","   </ul>","</div>"].join("")),o.render("nav","admin-pagetabs-nav")),o.on("nav("+e+")",function(a){var e=l(a),i=e.attr("lay-href");if(i&&"#"!==i){if(0===i.indexOf("javascript:"))return new Function(i.substring(11))();var a=e.attr("ew-title")||e.text().replace(/(^\s*)|(\s*$)/g,""),t=e.attr("ew-end");try{t=t?new Function(t):void 0}catch(a){}b.openTab({url:i,title:a,end:t}),layui.event.call(this,"admin","side({*})",{href:i})}}),o.on("tab("+c+")",function(){var a=l(this).attr("lay-id");b.mTabPosition=a!==b.homeUrl?a:void 0,s.cacheTab&&u.putTempData("tabPosition",b.mTabPosition),u.activeNav(a),u.rollPage("auto"),"true"!=l(d).attr("lay-autoRefresh")||y||u.refresh(a,!0),y=!1,layui.event.call(this,"admin","tab({*})",{layId:a})}),o.on("tabDelete("+c+")",function(a){var e=u.getTempData("menuRefers")||{},i=b.mTabList[a.index-1];if(i&&(b.mTabList.splice(a.index-1,1),s.cacheTab&&u.putTempData("indexTabs",b.mTabList),h[i.menuPath]&&h[i.menuPath].call(),layui.event.call(this,"admin","tabDelete({*})",{layId:i.menuPath})),e[i.menuPath]){var t,n=e[i.menuPath];if(delete e[i.menuPath],u.putTempData("menuRefers",e),l(d+">.layui-tab-title>li").each(function(){l(this).attr("lay-id")===n[0]&&(t=!0)}),t)return o.tabChange(c,n[0]),void(n[1]&&u.refresh(n[0]))}0===l(d+">.layui-tab-title>li.layui-this").length&&l(d+">.layui-tab-title>li:last").trigger("click")}),l(document).off("click.navMore").on("click.navMore","[nav-bind]",function(){var a=l(this).attr("nav-bind");l('ul[lay-filter="'+e+'"]').addClass("layui-hide"),l('ul[nav-id="'+a+'"]').removeClass("layui-hide"),l(i+">.layui-nav .layui-nav-item").removeClass("layui-this"),l(this).parent(".layui-nav-item").addClass("layui-this"),u.getPageWidth()<=768&&u.flexible(!1),layui.event.call(this,"admin","nav({*})",{navId:a})}),s.openTabCtxMenu&&s.pageTabs&&layui.use("contextMenu",function(){layui.contextMenu&&l(d+">.layui-tab-title").off("contextmenu.tab").on("contextmenu.tab","li",function(a){var e=l(this).attr("lay-id");return layui.contextMenu.show([{icon:"layui-icon layui-icon-refresh",name:"刷新当前",click:function(){o.tabChange(c,e),"true"!=l(d).attr("lay-autoRefresh")&&u.refresh(e)}},{icon:"layui-icon layui-icon-close-fill ctx-ic-lg",name:"关闭当前",click:function(){u.closeThisTabs(e)}},{icon:"layui-icon layui-icon-unlink",name:"关闭其他",click:function(){u.closeOtherTabs(e)}},{icon:"layui-icon layui-icon-close ctx-ic-lg",name:"关闭全部",click:function(){u.closeAllTabs()}}],a.clientX,a.clientY),!1})}),a("index",b)});