/** wulacms-v3.0.0 MIT License By https://github.com/ninggf/wulacms */
 ;function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}layui.define(["layer","form","table","util","admin","xmSelect","notice"],function(e){var s=layui.jquery,d=layui.layer,u=layui.form,l=layui.table,a=layui.util,c=layui.admin,f=layui.xmSelect,h=layui.notice;e("@backend.user",new(function(){function e(){_defineProperty(this,"insTb",void 0),_defineProperty(this,"where",{})}var t=e.prototype;return t.init=function(e){var r=this,t=s("#searchForm").outerHeight()+40;r.insTb=l.render({elem:"#userTable",url:c.url("backend/user/list"),page:!0,toolbar:s("#operationToolbar").html(),cellMinWidth:100,height:"full-"+t,defaultToolbar:["filter"],autoRow:!0,cols:[[{type:"checkbox",fixed:"left"},{field:"id",title:"ID",width:80,fixed:"left"},{field:"name",title:"账户",sort:!1},{field:"nickname",title:"姓名",minWidth:150,sort:!1},{field:"phone",title:"手机",sort:!1,minWidth:120},{field:"status",title:"状态",sort:!1,width:80,templet:function(e){var t="#5FB878";return 0!==e.status&&3!==e.status||(t="#FF5722"),"<p style='color:"+t+"'>"+e.format_status+"</p>"}},{field:"roles",title:"角色",width:160,sort:!1,templet:function(e){return e.roles.map(function(e){return'<p><span class="layui-badge layui-badge-gray">'+e+"</span></p>"}).join("")}},{field:"is_super_user",title:"超级管理员",width:100,sort:!1,templet:function(e){return 1===e.is_super_user?"是":"否"}},{field:"create_time",title:"创建时间",templet:function(e){return a.toDateString(e.create_time)},width:170},{field:"_ops",title:"操作",fixed:"right",toolbar:"#userTbBar",align:"center",width:110}]],lazy:!0,data:e,where:this.where,done:c.autoRowHeight("userTable")});var i=f.render({el:"#userRoleList",height:"250px",radio:!0,data:[],initValue:[],tips:"请选择用户角色",name:"roleId",prop:{name:"role",value:"id"},clickClose:!0,layVerType:"tips",model:{icon:"hidden",label:{type:"text"}}});c.get("backend/role/list?id=0").then(function(e){i.update({data:e.tree,tree:{show:!0,showFolderIcon:!0,indent:15,strict:!1,expandedKeys:[1],simple:!0},autoRow:!0})}),u.on("submit(userTbSearch)",function(e){return r.where=s.extend(r.where,e.field),r.insTb.reloadData(),!1}),l.on("tool(userTable)",function(e){var t=e.event,i=e.data;"edit"===t?r.showEditModel(i):"del"===e.event&&(1===i.is_super_user?h.error("超级管理员不能被删除!"):r.doDel({uids:[i.id]}))}),l.on("toolbar(userTable)",function(e){var t=e.event,e=l.checkStatus("userTable").data;"add"===t?r.showEditModel():"del"===t&&(0!==e.length?(e=e.map(function(e){return e.id}),r.doDel({uids:e})):h.error("请选择要删除的用户"))}),u.on("switch(status)",function(e){var t=e.elem.checked?2:1;e.elem.value=t})},t.showEditModel=function(l){var a=this.insTb,n=(l?"修改":"添加")+"用户",o=l?"backend/user/save":"backend/user/add";c.open({type:1,area:"680px",title:n,content:s("#userEditDialog").html(),success:function(e,i){var t=s("#passwd");l?s(e).find("#resetOnFirstLogin").remove():(t.children("label.layui-form-label").addClass("layui-form-required"),s("#passwdInput")[0].setAttribute("lay-verify","required"),s(e).find("#setUserStatus").remove()),u.val("userEditForm",l),u.on("submit(userEditSubmit)",function(e){e.field.uid=l?l.id:"";var t=d.load(2);return c.post(o,e.field).then(function(e){200===e.code?(d.close(i),h.success(n+"成功"),a.reload()):h.error(e.message)}).fail(function(e){h.error(e.message)}),d.close(t),!1});var r=f.render({el:"#userEditRoleSel",height:"250px",data:[],initValue:l?l.roleIds:[],tips:"请选择用户角色",name:"roleIds",prop:{name:"role",value:"id"},clickClose:!0,layVerify:"required",layVerType:"tips"});c.get("backend/role/list?id=0").then(function(e){r.update({data:e.tree,tree:{show:!0,showFolderIcon:!0,indent:15,strict:!1,expandedKeys:[1],simple:!0},autoRow:!0})}),s(e).children(".layui-layer-content").css("overflow","visible")}})},t.doDel=function(i){var r=this.insTb;d.confirm("确定要删除选中的用户吗？",{skin:"layui-layer-admin",shade:.1},function(e){d.close(e);var t=d.load(2);c.post("backend/user/del",i).then(function(e){d.close(t),200===e.code?(h.success("删除用户成功"),r.reload()):h.error(e.message)}).fail(function(e){h.error(e.message)})})},e}()))});