/** wulacms-v3.0.0 MIT License By https://github.com/ninggf/wulacms */
 ;function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}layui.define(["layer","form","table","util","admin","xmSelect","notice"],function(e){var s=layui.jquery,u=layui.layer,d=layui.form,n=layui.table,a=layui.util,c=layui.admin,f=layui.xmSelect,p=layui.notice;e("@backend.user",new(function(){function e(){_defineProperty(this,"insTb",void 0)}var t=e.prototype;return t.init=function(e){var r=this,t=s("#searchForm").outerHeight()+40;r.insTb=n.render({elem:"#userTable",url:c.url("backend/user/list"),page:!0,toolbar:s("#operationToolbar").html(),cellMinWidth:100,height:"full-"+t,defaultToolbar:["filter"],autoRow:!0,cols:[[{type:"checkbox"},{type:"numbers"},{field:"name",title:"账户",sort:!1},{field:"nickname",title:"姓名",sort:!1},{field:"phone",title:"手机",sort:!1,minWidth:120},{field:"status",title:"状态",sort:!1,width:80,templet:function(e){var t="#5FB878";return 0!==e.status&&3!==e.status||(t="#FF5722"),"<p style='color:"+t+"'>"+e.format_status+"</p>"}},{field:"roles",title:"角色",minWidth:160,sort:!1,templet:function(e){return e.roles.map(function(e){return'<span class="layui-badge layui-badge-gray">'+e+"</span>"}).join("&nbsp;&nbsp;")}},{field:"is_super_user",title:"超级管理员",width:100,sort:!1,templet:function(e){return 1===e.is_super_user?"是":"否"}},{field:"create_time",title:"创建时间",templet:function(e){return a.toDateString(e.create_time)},width:160},{field:"_ops",title:"操作",toolbar:"#userTbBar",align:"center",width:110,minWidth:110}]],lazy:!0,data:e});var i=f.render({el:"#userRoleList",height:"250px",radio:!0,data:[],initValue:[],tips:"请选择用户角色",name:"roleId",prop:{name:"role",value:"id"},clickClose:!0,layVerType:"tips"});c.get("backend/role/list?id=0").then(function(e){i.update({data:e.tree,tree:{show:!0,showFolderIcon:!0,indent:15,strict:!1,expandedKeys:[1],simple:!0},autoRow:!0})}),d.on("submit(userTbSearch)",function(e){return r.insTb.reload({where:e.field,page:{curr:1}}),!1}),n.on("tool(userTable)",function(e){var t=e.event,i=e.data;"edit"===t?r.showEditModel(i):"del"===e.event&&(1===i.is_super_user?p.error("超级管理员不能被删除!"):r.doDel({uids:[i.id]}))}),n.on("toolbar(userTable)",function(e){var t=e.event,e=n.checkStatus("userTable").data;"add"===t?r.showEditModel():"del"===t&&(0!==e.length?(e=e.map(function(e){return e.id}),r.doDel({uids:e})):p.error("请选择要删除的用户"))}),d.on("switch(status)",function(e){var t=e.elem.checked?2:1;e.elem.value=t})},t.showEditModel=function(n){var a=this.insTb,l=(n?"修改":"添加")+"用户",o=n?"backend/user/save":"backend/user/add";c.open({type:1,area:"680px",title:l,content:s("#userEditDialog").html(),success:function(e,i){var t=s("#passwd");n?s(e).find("#resetOnFirstLogin").remove():(t.children("label.layui-form-label").addClass("layui-form-required"),s("#passwdInput")[0].setAttribute("lay-verify","required"),s(e).find("#setUserStatus").remove()),d.val("userEditForm",n),d.on("submit(userEditSubmit)",function(e){e.field.uid=n?n.id:"";var t=u.load(2);return c.post(o,e.field).then(function(e){200===e.code?(u.close(i),p.success(l+"成功"),a.reload()):p.error(e.message)}).fail(function(e){p.error(e.message)}),u.close(t),!1});var r=f.render({el:"#userEditRoleSel",height:"250px",data:[],initValue:n?n.roleIds:[],tips:"请选择用户角色",name:"roleIds",prop:{name:"role",value:"id"},clickClose:!0,layVerify:"required",layVerType:"tips"});c.get("backend/role/list?id=0").then(function(e){r.update({data:e.tree,tree:{show:!0,showFolderIcon:!0,indent:15,strict:!1,expandedKeys:[1],simple:!0},autoRow:!0})}),s(e).children(".layui-layer-content").css("overflow","visible")}})},t.doDel=function(i){var r=this.insTb;u.confirm("确定要删除选中的用户吗？",{skin:"layui-layer-admin",shade:.1},function(e){u.close(e);var t=u.load(2);c.post("backend/user/del",i).then(function(e){u.close(t),200===e.code?(p.success("删除用户成功"),r.reload()):p.error(e.message)}).fail(function(e){p.error(e.message)})})},e}()))});