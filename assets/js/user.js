function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}layui.define(['layer','form','table','util','admin','xmSelect','notice'],function(exports){var $=layui.jquery;var layer=layui.layer;var form=layui.form;var table=layui.table;var util=layui.util;var admin=layui.admin;var xmSelect=layui.xmSelect;var notice=layui.notice;var User=/*#__PURE__*/function(){function User(){_defineProperty(this,"insTb",void 0);_defineProperty(this,"where",{});}var _proto=User.prototype;_proto.init=function init(data){var _this=this,topH=$('#searchForm').outerHeight()+40;/* 渲染表格 */_this.insTb=table.render({elem:'#userTable',url:admin.url('backend/user/list'),page:true,toolbar:$('#operationToolbar').html(),cellMinWidth:100,height:'full-'+topH,defaultToolbar:['filter'],autoRow:true,cols:[[{type:'checkbox'},{type:'numbers'},{field:'name',title:'账户',sort:false},{field:'nickname',title:'姓名',sort:false},{field:'phone',title:'手机',sort:false,minWidth:120},{field:'status',title:'状态',sort:false,width:80,templet:function templet(d){var color='#5FB878';if(d.status===0||d.status===3){color='#FF5722';}return"<p style='color:"+color+"'>"+d.format_status+"</p>";}},{field:'roles',title:'角色',minWidth:160,sort:false,templet:function templet(d){return d.roles.map(function(item){return'<span class="layui-badge layui-badge-gray">'+item+'</span>';}).join('&nbsp;&nbsp;');}},{field:'is_super_user',title:'超级管理员',width:100,sort:false,templet:function templet(d){return d.is_super_user===1?'是':'否';}},{field:'create_time',title:'创建时间',templet:function templet(d){return util.toDateString(d.create_time);},width:160},{field:'_ops',title:'操作',toolbar:'#userTbBar',align:'center',width:110,minWidth:110}]],lazy:true,data:data,where:this.where});var userRoleList=xmSelect.render({el:'#userRoleList',height:'250px',radio:true,data:[],initValue:[],tips:'请选择用户角色',name:'roleId',prop:{name:'role',value:'id'},clickClose:true,layVerType:'tips',model:{icon:'hidden',label:{type:'text'}}});admin.get('backend/role/list?id=0').then(function(data){userRoleList.update({data:data.tree,tree:{show:true,showFolderIcon:true,indent:15,strict:false,expandedKeys:[1],simple:true},autoRow:true});});/* 表格搜索 */form.on('submit(userTbSearch)',function(data){_this.where=$.extend(_this.where,data.field);_this.insTb.reloadData();return false;});/* 表格工具条点击事件 */table.on('tool(userTable)',function(obj){var event=obj.event;var user=obj.data;if(event==='edit'){_this.showEditModel(user);}else if(obj.event==='del'){user.is_super_user===1?notice.error('超级管理员不能被删除!'):_this.doDel({uids:[user.id]});}});/* 表格头工具栏点击事件 */table.on('toolbar(userTable)',function(obj){var event=obj.event;var checkRows=table.checkStatus('userTable').data;if(event==='add'){_this.showEditModel();}else if(event==='del'){if(checkRows.length===0){notice.error('请选择要删除的用户');return;}var ids=checkRows.map(function(d){return d.id;});_this.doDel({uids:ids});}});//密码框switch监听
form.on('switch(status)',function(data){var status=data.elem.checked?2:1;data.elem.value=status;});}/* 显示表单弹窗 */;_proto.showEditModel=function showEditModel(mData){var insTb=this.insTb;var title=(mData?'修改':'添加')+'用户';var url=mData?'backend/user/save':'backend/user/add';admin.open({type:1,area:'680px',title:title,content:$('#userEditDialog').html(),success:function success(layero,dIndex){var dom=$('#passwd');if(!mData){dom.children('label.layui-form-label').addClass('layui-form-required');$('#passwdInput')[0].setAttribute('lay-verify','required');$(layero).find('#setUserStatus').remove();}else{$(layero).find('#resetOnFirstLogin').remove();}// 回显表单数据
form.val('userEditForm',mData);// 表单提交事件
form.on('submit(userEditSubmit)',function(data){data.field.uid=mData?mData.id:'';var loadIndex=layer.load(2);admin.post(url,data.field).then(function(data){if(data.code===200){layer.close(dIndex);notice.success(title+'成功');insTb.reload();}else{notice.error(data.message);}}).fail(function(data){notice.error(data.message);});layer.close(loadIndex);return false;});// 渲染多选下拉框
var insRoleSel=xmSelect.render({el:'#userEditRoleSel',height:'250px',data:[],initValue:mData?mData.roleIds:[],tips:'请选择用户角色',name:'roleIds',prop:{name:'role',value:'id'},clickClose:true,layVerify:'required',layVerType:'tips'});admin.get('backend/role/list?id=0').then(function(data){insRoleSel.update({data:data.tree,tree:{show:true,showFolderIcon:true,indent:15,strict:false,expandedKeys:[1],simple:true},autoRow:true});});// 禁止弹窗出现滚动条
$(layero).children('.layui-layer-content').css('overflow','visible');}});};_proto.doDel=function doDel(obj){var insTb=this.insTb;layer.confirm('确定要删除选中的用户吗？',{skin:'layui-layer-admin',shade:.1},function(i){layer.close(i);var loadIndex=layer.load(2);admin.post('backend/user/del',obj).then(function(data){layer.close(loadIndex);if(data.code===200){notice.success('删除用户成功');insTb.reload();}else{notice.error(data.message);}}).fail(function(data){notice.error(data.message);});});};return User;}();exports('@backend.user',new User());});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIudnVlIl0sIm5hbWVzIjpbImxheXVpIiwiZGVmaW5lIiwiZXhwb3J0cyIsIiQiLCJqcXVlcnkiLCJsYXllciIsImZvcm0iLCJ0YWJsZSIsInV0aWwiLCJhZG1pbiIsInhtU2VsZWN0Iiwibm90aWNlIiwiVXNlciIsImluaXQiLCJkYXRhIiwiX3RoaXMiLCJ0b3BIIiwib3V0ZXJIZWlnaHQiLCJpbnNUYiIsInJlbmRlciIsImVsZW0iLCJ1cmwiLCJwYWdlIiwidG9vbGJhciIsImh0bWwiLCJjZWxsTWluV2lkdGgiLCJoZWlnaHQiLCJkZWZhdWx0VG9vbGJhciIsImF1dG9Sb3ciLCJjb2xzIiwidHlwZSIsImZpZWxkIiwidGl0bGUiLCJzb3J0IiwibWluV2lkdGgiLCJ3aWR0aCIsInRlbXBsZXQiLCJkIiwiY29sb3IiLCJzdGF0dXMiLCJmb3JtYXRfc3RhdHVzIiwicm9sZXMiLCJtYXAiLCJpdGVtIiwiam9pbiIsImlzX3N1cGVyX3VzZXIiLCJ0b0RhdGVTdHJpbmciLCJjcmVhdGVfdGltZSIsImFsaWduIiwibGF6eSIsIndoZXJlIiwidXNlclJvbGVMaXN0IiwiZWwiLCJyYWRpbyIsImluaXRWYWx1ZSIsInRpcHMiLCJuYW1lIiwicHJvcCIsInZhbHVlIiwiY2xpY2tDbG9zZSIsImxheVZlclR5cGUiLCJtb2RlbCIsImljb24iLCJsYWJlbCIsImdldCIsInRoZW4iLCJ1cGRhdGUiLCJ0cmVlIiwic2hvdyIsInNob3dGb2xkZXJJY29uIiwiaW5kZW50Iiwic3RyaWN0IiwiZXhwYW5kZWRLZXlzIiwic2ltcGxlIiwib24iLCJleHRlbmQiLCJyZWxvYWREYXRhIiwib2JqIiwiZXZlbnQiLCJ1c2VyIiwic2hvd0VkaXRNb2RlbCIsImVycm9yIiwiZG9EZWwiLCJ1aWRzIiwiaWQiLCJjaGVja1Jvd3MiLCJjaGVja1N0YXR1cyIsImxlbmd0aCIsImlkcyIsImNoZWNrZWQiLCJtRGF0YSIsIm9wZW4iLCJhcmVhIiwiY29udGVudCIsInN1Y2Nlc3MiLCJsYXllcm8iLCJkSW5kZXgiLCJkb20iLCJjaGlsZHJlbiIsImFkZENsYXNzIiwic2V0QXR0cmlidXRlIiwiZmluZCIsInJlbW92ZSIsInZhbCIsInVpZCIsImxvYWRJbmRleCIsImxvYWQiLCJwb3N0IiwiY29kZSIsImNsb3NlIiwicmVsb2FkIiwibWVzc2FnZSIsImZhaWwiLCJpbnNSb2xlU2VsIiwicm9sZUlkcyIsImxheVZlcmlmeSIsImNzcyIsImNvbmZpcm0iLCJza2luIiwic2hhZGUiLCJpIl0sIm1hcHBpbmdzIjoic0xBQUFBLEtBQUssQ0FBQ0MsTUFBTixDQUFhLENBQUMsT0FBRCxDQUFVLE1BQVYsQ0FBa0IsT0FBbEIsQ0FBMkIsTUFBM0IsQ0FBbUMsT0FBbkMsQ0FBNEMsVUFBNUMsQ0FBd0QsUUFBeEQsQ0FBYixDQUFnRixTQUFVQyxPQUFWLENBQW1CLENBQ2pHLEdBQUlDLENBQUFBLENBQUMsQ0FBVUgsS0FBSyxDQUFDSSxNQUFyQixDQUNBLEdBQUlDLENBQUFBLEtBQUssQ0FBTUwsS0FBSyxDQUFDSyxLQUFyQixDQUNBLEdBQUlDLENBQUFBLElBQUksQ0FBT04sS0FBSyxDQUFDTSxJQUFyQixDQUNBLEdBQUlDLENBQUFBLEtBQUssQ0FBTVAsS0FBSyxDQUFDTyxLQUFyQixDQUNBLEdBQUlDLENBQUFBLElBQUksQ0FBT1IsS0FBSyxDQUFDUSxJQUFyQixDQUNBLEdBQUlDLENBQUFBLEtBQUssQ0FBTVQsS0FBSyxDQUFDUyxLQUFyQixDQUNBLEdBQUlDLENBQUFBLFFBQVEsQ0FBR1YsS0FBSyxDQUFDVSxRQUFyQixDQUNBLEdBQUlDLENBQUFBLE1BQU0sQ0FBS1gsS0FBSyxDQUFDVyxNQUFyQixDQVJpRyxHQVUzRkMsQ0FBQUEsSUFWMkYsMkdBWXZGLEVBWnVGLG9DQWMvRkMsSUFkK0YsQ0FjL0YsY0FBS0MsSUFBTCxDQUFXLENBQ1QsR0FBSUMsQ0FBQUEsS0FBSyxDQUFHLElBQVosQ0FBa0JDLElBQUksQ0FBR2IsQ0FBQyxDQUFDLGFBQUQsQ0FBRCxDQUFpQmMsV0FBakIsR0FBaUMsRUFBMUQs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QUFsQixFQUNELENBVkQsRUFXRCxDQWpCRCxFQWtCRCxDQS9POEYsaUJBa1BqRzdHLE9BQU8sQ0FBQyxlQUFELENBQWtCLEdBQUlVLENBQUFBLElBQUosRUFBbEIsQ0FBUCxDQUNELENBblBEIiwic291cmNlc0NvbnRlbnQiOlsibGF5dWkuZGVmaW5lKFsnbGF5ZXInLCAnZm9ybScsICd0YWJsZScsICd1dGlsJywgJ2FkbWluJywgJ3htU2VsZWN0JywgJ25vdGljZSddLCBmdW5jdGlvbiAoZXhwb3J0cykge1xuICBsZXQgJCAgICAgICAgPSBsYXl1aS5qcXVlcnk7XG4gIGxldCBsYXllciAgICA9IGxheXVpLmxheWVyO1xuICBsZXQgZm9ybSAgICAgPSBsYXl1aS5mb3JtO1xuICBsZXQgdGFibGUgICAgPSBsYXl1aS50YWJsZTtcbiAgbGV0IHV0aWwgICAgID0gbGF5dWkudXRpbDtcbiAgbGV0IGFkbWluICAgID0gbGF5dWkuYWRtaW47XG4gIGxldCB4bVNlbGVjdCA9IGxheXVpLnhtU2VsZWN0O1xuICBsZXQgbm90aWNlICAgPSBsYXl1aS5ub3RpY2U7XG5cbiAgY2xhc3MgVXNlciB7XG4gICAgaW5zVGJcbiAgICB3aGVyZSA9IHt9XG5cbiAgICBpbml0KGRhdGEpIHtcbiAgICAgIGxldCBfdGhpcyA9IHRoaXMsIHRvcEggPSAkKCcjc2VhcmNoRm9ybScpLm91dGVySGVpZ2h0KCkgKyA0MDtcbiAgICAgIC8qIOa4suafk+ihqOagvCAqL1xuICAgICAgX3RoaXMuaW5zVGIgPSB0YWJsZS5yZW5kZXIoe1xuICAgICAgICBlbGVtICAgICAgICAgIDogJyN1c2VyVGFibGUnLFxuICAgICAgICB1cmwgICAgICAgICAgIDogYWRtaW4udXJsKCdiYWNrZW5kL3VzZXIvbGlzdCcpLFxuICAgICAgICBwYWdlICAgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgdG9vbGJhciAgICAgICA6ICQoJyNvcGVyYXRpb25Ub29sYmFyJykuaHRtbCgpLFxuICAgICAgICBjZWxsTWluV2lkdGggIDogMTAwLFxuICAgICAgICBoZWlnaHQgICAgICAgIDogJ2Z1bGwtJyArIHRvcEgsXG4gICAgICAgIGRlZmF1bHRUb29sYmFyOiBbJ2ZpbHRlciddLFxuICAgICAgICBhdXRvUm93ICAgICAgIDogdHJ1ZSxcbiAgICAgICAgY29scyAgICAgICAgICA6IFtbXG4gICAgICAgICAge3R5cGU6ICdjaGVja2JveCd9LFxuICAgICAgICAgIHt0eXBlOiAnbnVtYmVycyd9LFxuICAgICAgICAgIHtmaWVsZDogJ25hbWUnLCB0aXRsZTogJ+i0puaItycsIHNvcnQ6IGZhbHNlfSxcbiAgICAgICAgICB7ZmllbGQ6ICduaWNrbmFtZScsIHRpdGxlOiAn5aeT5ZCNJywgc29ydDogZmFsc2V9LFxuICAgICAgICAgIHtmaWVsZDogJ3Bob25lJywgdGl0bGU6ICfmiYvmnLonLCBzb3J0OiBmYWxzZSwgbWluV2lkdGg6IDEyMH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdzdGF0dXMnLCB0aXRsZTogJ+eKtuaAgScsIHNvcnQ6IGZhbHNlLCB3aWR0aDogODAsIHRlbXBsZXQ6IChkKSA9PiB7XG4gICAgICAgICAgICAgIGxldCBjb2xvciA9ICcjNUZCODc4JztcbiAgICAgICAgICAgICAgaWYgKGQuc3RhdHVzID09PSAwIHx8IGQuc3RhdHVzID09PSAzKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSAnI0ZGNTcyMic7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIFwiPHAgc3R5bGU9J2NvbG9yOlwiICsgY29sb3IgKyBcIic+XCIgKyBkLmZvcm1hdF9zdGF0dXMgKyBcIjwvcD5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAncm9sZXMnLCB0aXRsZTogJ+inkuiJsicsIG1pbldpZHRoOiAxNjAsIHNvcnQ6IGZhbHNlLCB0ZW1wbGV0OiAoZCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gZC5yb2xlcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPVwibGF5dWktYmFkZ2UgbGF5dWktYmFkZ2UtZ3JheVwiPicgKyBpdGVtICsgJzwvc3Bhbj4nO1xuICAgICAgICAgICAgICB9KS5qb2luKCcmbmJzcDsmbmJzcDsnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnaXNfc3VwZXJfdXNlcicsIHRpdGxlOiAn6LaF57qn566h55CG5ZGYJywgd2lkdGg6IDEwMCwgc29ydDogZmFsc2UsIHRlbXBsZXQ6IChkKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBkLmlzX3N1cGVyX3VzZXIgPT09IDEgPyAn5pivJyA6ICflkKYnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZCAgOiAnY3JlYXRlX3RpbWUnLCB0aXRsZTogJ+WIm+W7uuaXtumXtCcsIHRlbXBsZXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgIHJldHVybiB1dGlsLnRvRGF0ZVN0cmluZyhkLmNyZWF0ZV90aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgd2lkdGg6IDE2MCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtmaWVsZDogJ19vcHMnLCB0aXRsZTogJ+aTjeS9nCcsIHRvb2xiYXI6ICcjdXNlclRiQmFyJywgYWxpZ246ICdjZW50ZXInLCB3aWR0aDogMTEwLCBtaW5XaWR0aDogMTEwfVxuICAgICAgICBdXSxcbiAgICAgICAgbGF6eSAgICAgICAgICA6IHRydWUsXG4gICAgICAgIGRhdGEgICAgICAgICAgOiBkYXRhLFxuICAgICAgICB3aGVyZSAgICAgICAgIDogdGhpcy53aGVyZVxuICAgICAgfSk7XG5cbiAgICAgIGxldCB1c2VyUm9sZUxpc3QgPSB4bVNlbGVjdC5yZW5kZXIoe1xuICAgICAgICBlbCAgICAgICAgOiAnI3VzZXJSb2xlTGlzdCcsXG4gICAgICAgIGhlaWdodCAgICA6ICcyNTBweCcsXG4gICAgICAgIHJhZGlvICAgICA6IHRydWUsXG4gICAgICAgIGRhdGEgICAgICA6IFtdLFxuICAgICAgICBpbml0VmFsdWUgOiBbXSxcbiAgICAgICAgdGlwcyAgICAgIDogJ+ivt+mAieaLqeeUqOaIt+inkuiJsicsXG4gICAgICAgIG5hbWUgICAgICA6ICdyb2xlSWQnLFxuICAgICAgICBwcm9wICAgICAgOiB7XG4gICAgICAgICAgbmFtZSA6ICdyb2xlJyxcbiAgICAgICAgICB2YWx1ZTogJ2lkJ1xuICAgICAgICB9LFxuICAgICAgICBjbGlja0Nsb3NlOiB0cnVlLFxuICAgICAgICBsYXlWZXJUeXBlOiAndGlwcycsXG4gICAgICAgIG1vZGVsICAgICA6IHtcbiAgICAgICAgICBpY29uIDogJ2hpZGRlbicsXG4gICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGFkbWluLmdldCgnYmFja2VuZC9yb2xlL2xpc3Q/aWQ9MCcpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdXNlclJvbGVMaXN0LnVwZGF0ZSh7XG4gICAgICAgICAgZGF0YSAgIDogZGF0YS50cmVlLFxuICAgICAgICAgIHRyZWUgICA6IHtcbiAgICAgICAgICAgIHNob3cgICAgICAgICAgOiB0cnVlLFxuICAgICAgICAgICAgc2hvd0ZvbGRlckljb246IHRydWUsXG4gICAgICAgICAgICBpbmRlbnQgICAgICAgIDogMTUsXG4gICAgICAgICAgICBzdHJpY3QgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICBleHBhbmRlZEtleXMgIDogWzFdLFxuICAgICAgICAgICAgc2ltcGxlICAgICAgICA6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhdXRvUm93OiB0cnVlLFxuICAgICAgICB9KVxuICAgICAgfSk7XG5cbiAgICAgIC8qIOihqOagvOaQnOe0oiAqL1xuICAgICAgZm9ybS5vbignc3VibWl0KHVzZXJUYlNlYXJjaCknLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBfdGhpcy53aGVyZSA9ICQuZXh0ZW5kKF90aGlzLndoZXJlLCBkYXRhLmZpZWxkKVxuICAgICAgICBfdGhpcy5pbnNUYi5yZWxvYWREYXRhKClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIC8qIOihqOagvOW3peWFt+adoeeCueWHu+S6i+S7tiAqL1xuICAgICAgdGFibGUub24oJ3Rvb2wodXNlclRhYmxlKScsIGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgbGV0IGV2ZW50ID0gb2JqLmV2ZW50XG4gICAgICAgIGxldCB1c2VyICA9IG9iai5kYXRhXG4gICAgICAgIGlmIChldmVudCA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgX3RoaXMuc2hvd0VkaXRNb2RlbCh1c2VyKTtcbiAgICAgICAgfSBlbHNlIGlmIChvYmouZXZlbnQgPT09ICdkZWwnKSB7XG4gICAgICAgICAgdXNlci5pc19zdXBlcl91c2VyID09PSAxID8gbm90aWNlLmVycm9yKCfotoXnuqfnrqHnkIblkZjkuI3og73ooqvliKDpmaQhJykgOiBfdGhpcy5kb0RlbCh7dWlkczogW3VzZXIuaWRdfSlcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8qIOihqOagvOWktOW3peWFt+agj+eCueWHu+S6i+S7tiAqL1xuICAgICAgdGFibGUub24oJ3Rvb2xiYXIodXNlclRhYmxlKScsIGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgbGV0IGV2ZW50ICAgICA9IG9iai5ldmVudFxuICAgICAgICBsZXQgY2hlY2tSb3dzID0gdGFibGUuY2hlY2tTdGF0dXMoJ3VzZXJUYWJsZScpLmRhdGFcbiAgICAgICAgaWYgKGV2ZW50ID09PSAnYWRkJykge1xuICAgICAgICAgIF90aGlzLnNob3dFZGl0TW9kZWwoKTtcbiAgICAgICAgfSBlbHNlIGlmIChldmVudCA9PT0gJ2RlbCcpIHtcbiAgICAgICAgICBpZiAoY2hlY2tSb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgbm90aWNlLmVycm9yKCfor7fpgInmi6nopoHliKDpmaTnmoTnlKjmiLcnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IGlkcyA9IGNoZWNrUm93cy5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBkLmlkO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIF90aGlzLmRvRGVsKHt1aWRzOiBpZHN9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAvL+WvhueggeahhnN3aXRjaOebkeWQrFxuICAgICAgZm9ybS5vbignc3dpdGNoKHN0YXR1cyknLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBsZXQgc3RhdHVzICAgICAgPSBkYXRhLmVsZW0uY2hlY2tlZCA/IDIgOiAxXG4gICAgICAgIGRhdGEuZWxlbS52YWx1ZSA9IHN0YXR1c1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyog5pi+56S66KGo5Y2V5by556qXICovXG4gICAgc2hvd0VkaXRNb2RlbChtRGF0YSkge1xuICAgICAgbGV0IGluc1RiID0gdGhpcy5pbnNUYlxuICAgICAgbGV0IHRpdGxlID0gKG1EYXRhID8gJ+S/ruaUuScgOiAn5re75YqgJykgKyAn55So5oi3J1xuICAgICAgbGV0IHVybCAgID0gbURhdGEgPyAnYmFja2VuZC91c2VyL3NhdmUnIDogJ2JhY2tlbmQvdXNlci9hZGQnXG4gICAgICBhZG1pbi5vcGVuKHtcbiAgICAgICAgdHlwZSAgIDogMSxcbiAgICAgICAgYXJlYSAgIDogJzY4MHB4JyxcbiAgICAgICAgdGl0bGUgIDogdGl0bGUsXG4gICAgICAgIGNvbnRlbnQ6ICQoJyN1c2VyRWRpdERpYWxvZycpLmh0bWwoKSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGxheWVybywgZEluZGV4KSB7XG4gICAgICAgICAgbGV0IGRvbSA9ICQoJyNwYXNzd2QnKVxuICAgICAgICAgIGlmICghbURhdGEpIHtcbiAgICAgICAgICAgIGRvbS5jaGlsZHJlbignbGFiZWwubGF5dWktZm9ybS1sYWJlbCcpLmFkZENsYXNzKCdsYXl1aS1mb3JtLXJlcXVpcmVkJylcbiAgICAgICAgICAgICQoJyNwYXNzd2RJbnB1dCcpWzBdLnNldEF0dHJpYnV0ZSgnbGF5LXZlcmlmeScsICdyZXF1aXJlZCcpXG4gICAgICAgICAgICAkKGxheWVybykuZmluZCgnI3NldFVzZXJTdGF0dXMnKS5yZW1vdmUoKVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKGxheWVybykuZmluZCgnI3Jlc2V0T25GaXJzdExvZ2luJykucmVtb3ZlKClcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8g5Zue5pi+6KGo5Y2V5pWw5o2uXG4gICAgICAgICAgZm9ybS52YWwoJ3VzZXJFZGl0Rm9ybScsIG1EYXRhKTtcbiAgICAgICAgICAvLyDooajljZXmj5DkuqTkuovku7ZcbiAgICAgICAgICBmb3JtLm9uKCdzdWJtaXQodXNlckVkaXRTdWJtaXQpJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGRhdGEuZmllbGQudWlkID0gbURhdGEgPyBtRGF0YS5pZCA6ICcnO1xuICAgICAgICAgICAgdmFyIGxvYWRJbmRleCAgPSBsYXllci5sb2FkKDIpO1xuICAgICAgICAgICAgYWRtaW4ucG9zdCh1cmwsIGRhdGEuZmllbGQpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGRhdGEuY29kZSA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgbGF5ZXIuY2xvc2UoZEluZGV4KTtcbiAgICAgICAgICAgICAgICBub3RpY2Uuc3VjY2Vzcyh0aXRsZSArICfmiJDlip8nKVxuICAgICAgICAgICAgICAgIGluc1RiLnJlbG9hZCgpXG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbm90aWNlLmVycm9yKGRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZhaWwoKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgbm90aWNlLmVycm9yKGRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgbGF5ZXIuY2xvc2UobG9hZEluZGV4KTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyDmuLLmn5PlpJrpgInkuIvmi4nmoYZcbiAgICAgICAgICBsZXQgaW5zUm9sZVNlbCA9IHhtU2VsZWN0LnJlbmRlcih7XG4gICAgICAgICAgICBlbCAgICAgICAgOiAnI3VzZXJFZGl0Um9sZVNlbCcsXG4gICAgICAgICAgICBoZWlnaHQgICAgOiAnMjUwcHgnLFxuICAgICAgICAgICAgZGF0YSAgICAgIDogW10sXG4gICAgICAgICAgICBpbml0VmFsdWUgOiBtRGF0YSA/IG1EYXRhLnJvbGVJZHMgOiBbXSxcbiAgICAgICAgICAgIHRpcHMgICAgICA6ICfor7fpgInmi6nnlKjmiLfop5LoibInLFxuICAgICAgICAgICAgbmFtZSAgICAgIDogJ3JvbGVJZHMnLFxuICAgICAgICAgICAgcHJvcCAgICAgIDoge1xuICAgICAgICAgICAgICBuYW1lIDogJ3JvbGUnLFxuICAgICAgICAgICAgICB2YWx1ZTogJ2lkJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsaWNrQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICBsYXlWZXJpZnkgOiAncmVxdWlyZWQnLFxuICAgICAgICAgICAgbGF5VmVyVHlwZTogJ3RpcHMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGFkbWluLmdldCgnYmFja2VuZC9yb2xlL2xpc3Q/aWQ9MCcpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGluc1JvbGVTZWwudXBkYXRlKHtcbiAgICAgICAgICAgICAgZGF0YSAgIDogZGF0YS50cmVlLFxuICAgICAgICAgICAgICB0cmVlICAgOiB7XG4gICAgICAgICAgICAgICAgc2hvdyAgICAgICAgICA6IHRydWUsXG4gICAgICAgICAgICAgICAgc2hvd0ZvbGRlckljb246IHRydWUsXG4gICAgICAgICAgICAgICAgaW5kZW50ICAgICAgICA6IDE1LFxuICAgICAgICAgICAgICAgIHN0cmljdCAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBleHBhbmRlZEtleXMgIDogWzFdLFxuICAgICAgICAgICAgICAgIHNpbXBsZSAgICAgICAgOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhdXRvUm93OiB0cnVlLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyDnpoHmraLlvLnnqpflh7rnjrDmu5rliqjmnaFcbiAgICAgICAgICAkKGxheWVybykuY2hpbGRyZW4oJy5sYXl1aS1sYXllci1jb250ZW50JykuY3NzKCdvdmVyZmxvdycsICd2aXNpYmxlJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGRvRGVsKG9iaikge1xuICAgICAgbGV0IGluc1RiID0gdGhpcy5pbnNUYlxuICAgICAgbGF5ZXIuY29uZmlybSgn56Gu5a6a6KaB5Yig6Zmk6YCJ5Lit55qE55So5oi35ZCX77yfJywge1xuICAgICAgICBza2luIDogJ2xheXVpLWxheWVyLWFkbWluJyxcbiAgICAgICAgc2hhZGU6IC4xXG4gICAgICB9LCBmdW5jdGlvbiAoaSkge1xuICAgICAgICBsYXllci5jbG9zZShpKTtcbiAgICAgICAgbGV0IGxvYWRJbmRleCA9IGxheWVyLmxvYWQoMik7XG4gICAgICAgIGFkbWluLnBvc3QoJ2JhY2tlbmQvdXNlci9kZWwnLCBvYmopLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICBsYXllci5jbG9zZShsb2FkSW5kZXgpO1xuICAgICAgICAgIGlmIChkYXRhLmNvZGUgPT09IDIwMCkge1xuICAgICAgICAgICAgbm90aWNlLnN1Y2Nlc3MoJ+WIoOmZpOeUqOaIt+aIkOWKnycpO1xuICAgICAgICAgICAgaW5zVGIucmVsb2FkKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vdGljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkuZmFpbCgoZGF0YSkgPT4ge1xuICAgICAgICAgIG5vdGljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xuICAgICAgICB9KVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZXhwb3J0cygnQGJhY2tlbmQudXNlcicsIG5ldyBVc2VyKTtcbn0pOyJdLCJmaWxlIjoidXNlci5qcyJ9
