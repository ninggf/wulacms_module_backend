function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

layui.define(['layer', 'form', 'table', 'util', 'admin', 'xmSelect', 'notice'], function (exports) {
  var $ = layui.jquery;
  var layer = layui.layer;
  var form = layui.form;
  var table = layui.table;
  var util = layui.util;
  var admin = layui.admin;
  var xmSelect = layui.xmSelect;
  var notice = layui.notice;

  var User = /*#__PURE__*/function () {
    function User() {
      _defineProperty(this, "insTb", void 0);

      _defineProperty(this, "where", {});
    }

    var _proto = User.prototype;

    _proto.init = function init(data) {
      var _this = this,
          topH = $('#searchForm').outerHeight() + 40;
      /* 渲染表格 */


      _this.insTb = table.render({
        elem: '#userTable',
        url: admin.url('backend/user/list'),
        page: true,
        toolbar: $('#operationToolbar').html(),
        cellMinWidth: 100,
        height: 'full-' + topH,
        defaultToolbar: ['filter'],
        autoRow: true,
        cols: [[{
          type: 'checkbox'
        }, {
          type: 'numbers'
        }, {
          field: 'name',
          title: '账户',
          sort: false
        }, {
          field: 'nickname',
          title: '姓名',
          sort: false
        }, {
          field: 'phone',
          title: '手机',
          sort: false,
          minWidth: 120
        }, {
          field: 'status',
          title: '状态',
          sort: false,
          width: 80,
          templet: function templet(d) {
            var color = '#5FB878';

            if (d.status === 0 || d.status === 3) {
              color = '#FF5722';
            }

            return "<p style='color:" + color + "'>" + d.format_status + "</p>";
          }
        }, {
          field: 'roles',
          title: '角色',
          minWidth: 160,
          sort: false,
          templet: function templet(d) {
            return d.roles.map(function (item) {
              return '<span class="layui-badge layui-badge-gray">' + item + '</span>';
            }).join('&nbsp;&nbsp;');
          }
        }, {
          field: 'is_super_user',
          title: '超级管理员',
          width: 100,
          sort: false,
          templet: function templet(d) {
            return d.is_super_user === 1 ? '是' : '否';
          }
        }, {
          field: 'create_time',
          title: '创建时间',
          templet: function templet(d) {
            return util.toDateString(d.create_time);
          },
          width: 160
        }, {
          field: '_ops',
          title: '操作',
          toolbar: '#userTbBar',
          align: 'center',
          width: 110,
          minWidth: 110
        }]],
        lazy: true,
        data: data,
        where: this.where
      });
      var userRoleList = xmSelect.render({
        el: '#userRoleList',
        height: '250px',
        radio: true,
        data: [],
        initValue: [],
        tips: '请选择用户角色',
        name: 'roleId',
        prop: {
          name: 'role',
          value: 'id'
        },
        clickClose: true,
        layVerType: 'tips',
        model: {
          icon: 'hidden',
          label: {
            type: 'text'
          }
        }
      });
      admin.get('backend/role/list?id=0').then(function (data) {
        userRoleList.update({
          data: data.tree,
          tree: {
            show: true,
            showFolderIcon: true,
            indent: 15,
            strict: false,
            expandedKeys: [1],
            simple: true
          },
          autoRow: true
        });
      });
      /* 表格搜索 */

      form.on('submit(userTbSearch)', function (data) {
        _this.where = $.extend(_this.where, data.field);

        _this.insTb.reloadData();

        return false;
      });
      /* 表格工具条点击事件 */

      table.on('tool(userTable)', function (obj) {
        var event = obj.event;
        var user = obj.data;

        if (event === 'edit') {
          _this.showEditModel(user);
        } else if (obj.event === 'del') {
          user.is_super_user === 1 ? notice.error('超级管理员不能被删除!') : _this.doDel({
            uids: [user.id]
          });
        }
      });
      /* 表格头工具栏点击事件 */

      table.on('toolbar(userTable)', function (obj) {
        var event = obj.event;
        var checkRows = table.checkStatus('userTable').data;

        if (event === 'add') {
          _this.showEditModel();
        } else if (event === 'del') {
          if (checkRows.length === 0) {
            notice.error('请选择要删除的用户');
            return;
          }

          var ids = checkRows.map(function (d) {
            return d.id;
          });

          _this.doDel({
            uids: ids
          });
        }
      }); //密码框switch监听

      form.on('switch(status)', function (data) {
        var status = data.elem.checked ? 2 : 1;
        data.elem.value = status;
      });
    }
    /* 显示表单弹窗 */
    ;

    _proto.showEditModel = function showEditModel(mData) {
      var insTb = this.insTb;
      var title = (mData ? '修改' : '添加') + '用户';
      var url = mData ? 'backend/user/save' : 'backend/user/add';
      admin.open({
        type: 1,
        area: '680px',
        title: title,
        content: $('#userEditDialog').html(),
        success: function success(layero, dIndex) {
          var dom = $('#passwd');

          if (!mData) {
            dom.children('label.layui-form-label').addClass('layui-form-required');
            $('#passwdInput')[0].setAttribute('lay-verify', 'required');
            $(layero).find('#setUserStatus').remove();
          } else {
            $(layero).find('#resetOnFirstLogin').remove();
          } // 回显表单数据


          form.val('userEditForm', mData); // 表单提交事件

          form.on('submit(userEditSubmit)', function (data) {
            data.field.uid = mData ? mData.id : '';
            var loadIndex = layer.load(2);
            admin.post(url, data.field).then(function (data) {
              if (data.code === 200) {
                layer.close(dIndex);
                notice.success(title + '成功');
                insTb.reload();
              } else {
                notice.error(data.message);
              }
            }).fail(function (data) {
              notice.error(data.message);
            });
            layer.close(loadIndex);
            return false;
          }); // 渲染多选下拉框

          var insRoleSel = xmSelect.render({
            el: '#userEditRoleSel',
            height: '250px',
            data: [],
            initValue: mData ? mData.roleIds : [],
            tips: '请选择用户角色',
            name: 'roleIds',
            prop: {
              name: 'role',
              value: 'id'
            },
            clickClose: true,
            layVerify: 'required',
            layVerType: 'tips'
          });
          admin.get('backend/role/list?id=0').then(function (data) {
            insRoleSel.update({
              data: data.tree,
              tree: {
                show: true,
                showFolderIcon: true,
                indent: 15,
                strict: false,
                expandedKeys: [1],
                simple: true
              },
              autoRow: true
            });
          }); // 禁止弹窗出现滚动条

          $(layero).children('.layui-layer-content').css('overflow', 'visible');
        }
      });
    };

    _proto.doDel = function doDel(obj) {
      var insTb = this.insTb;
      layer.confirm('确定要删除选中的用户吗？', {
        skin: 'layui-layer-admin',
        shade: .1
      }, function (i) {
        layer.close(i);
        var loadIndex = layer.load(2);
        admin.post('backend/user/del', obj).then(function (data) {
          layer.close(loadIndex);

          if (data.code === 200) {
            notice.success('删除用户成功');
            insTb.reload();
          } else {
            notice.error(data.message);
          }
        }).fail(function (data) {
          notice.error(data.message);
        });
      });
    };

    return User;
  }();

  exports('@backend.user', new User());
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIudnVlIl0sIm5hbWVzIjpbImxheXVpIiwiZGVmaW5lIiwiZXhwb3J0cyIsIiQiLCJqcXVlcnkiLCJsYXllciIsImZvcm0iLCJ0YWJsZSIsInV0aWwiLCJhZG1pbiIsInhtU2VsZWN0Iiwibm90aWNlIiwiVXNlciIsImluaXQiLCJkYXRhIiwiX3RoaXMiLCJ0b3BIIiwib3V0ZXJIZWlnaHQiLCJpbnNUYiIsInJlbmRlciIsImVsZW0iLCJ1cmwiLCJwYWdlIiwidG9vbGJhciIsImh0bWwiLCJjZWxsTWluV2lkdGgiLCJoZWlnaHQiLCJkZWZhdWx0VG9vbGJhciIsImF1dG9Sb3ciLCJjb2xzIiwidHlwZSIsImZpZWxkIiwidGl0bGUiLCJzb3J0IiwibWluV2lkdGgiLCJ3aWR0aCIsInRlbXBsZXQiLCJkIiwiY29sb3IiLCJzdGF0dXMiLCJmb3JtYXRfc3RhdHVzIiwicm9sZXMiLCJtYXAiLCJpdGVtIiwiam9pbiIsImlzX3N1cGVyX3VzZXIiLCJ0b0RhdGVTdHJpbmciLCJjcmVhdGVfdGltZSIsImFsaWduIiwibGF6eSIsIndoZXJlIiwidXNlclJvbGVMaXN0IiwiZWwiLCJyYWRpbyIsImluaXRWYWx1ZSIsInRpcHMiLCJuYW1lIiwicHJvcCIsInZhbHVlIiwiY2xpY2tDbG9zZSIsImxheVZlclR5cGUiLCJtb2RlbCIsImljb24iLCJsYWJlbCIsImdldCIsInRoZW4iLCJ1cGRhdGUiLCJ0cmVlIiwic2hvdyIsInNob3dGb2xkZXJJY29uIiwiaW5kZW50Iiwic3RyaWN0IiwiZXhwYW5kZWRLZXlzIiwic2ltcGxlIiwib24iLCJleHRlbmQiLCJyZWxvYWREYXRhIiwib2JqIiwiZXZlbnQiLCJ1c2VyIiwic2hvd0VkaXRNb2RlbCIsImVycm9yIiwiZG9EZWwiLCJ1aWRzIiwiaWQiLCJjaGVja1Jvd3MiLCJjaGVja1N0YXR1cyIsImxlbmd0aCIsImlkcyIsImNoZWNrZWQiLCJtRGF0YSIsIm9wZW4iLCJhcmVhIiwiY29udGVudCIsInN1Y2Nlc3MiLCJsYXllcm8iLCJkSW5kZXgiLCJkb20iLCJjaGlsZHJlbiIsImFkZENsYXNzIiwic2V0QXR0cmlidXRlIiwiZmluZCIsInJlbW92ZSIsInZhbCIsInVpZCIsImxvYWRJbmRleCIsImxvYWQiLCJwb3N0IiwiY29kZSIsImNsb3NlIiwicmVsb2FkIiwibWVzc2FnZSIsImZhaWwiLCJpbnNSb2xlU2VsIiwicm9sZUlkcyIsImxheVZlcmlmeSIsImNzcyIsImNvbmZpcm0iLCJza2luIiwic2hhZGUiLCJpIl0sIm1hcHBpbmdzIjoiOztBQUFBQSxLQUFLLENBQUNDLE1BQU4sQ0FBYSxDQUFDLE9BQUQsRUFBVSxNQUFWLEVBQWtCLE9BQWxCLEVBQTJCLE1BQTNCLEVBQW1DLE9BQW5DLEVBQTRDLFVBQTVDLEVBQXdELFFBQXhELENBQWIsRUFBZ0YsVUFBVUMsT0FBVixFQUFtQjtBQUNqRyxNQUFJQyxDQUFDLEdBQVVILEtBQUssQ0FBQ0ksTUFBckI7QUFDQSxNQUFJQyxLQUFLLEdBQU1MLEtBQUssQ0FBQ0ssS0FBckI7QUFDQSxNQUFJQyxJQUFJLEdBQU9OLEtBQUssQ0FBQ00sSUFBckI7QUFDQSxNQUFJQyxLQUFLLEdBQU1QLEtBQUssQ0FBQ08sS0FBckI7QUFDQSxNQUFJQyxJQUFJLEdBQU9SLEtBQUssQ0FBQ1EsSUFBckI7QUFDQSxNQUFJQyxLQUFLLEdBQU1ULEtBQUssQ0FBQ1MsS0FBckI7QUFDQSxNQUFJQyxRQUFRLEdBQUdWLEtBQUssQ0FBQ1UsUUFBckI7QUFDQSxNQUFJQyxNQUFNLEdBQUtYLEtBQUssQ0FBQ1csTUFBckI7O0FBUmlHLE1BVTNGQyxJQVYyRjtBQUFBO0FBQUE7O0FBQUEscUNBWXZGLEVBWnVGO0FBQUE7O0FBQUE7O0FBQUEsV0FjL0ZDLElBZCtGLEdBYy9GLGNBQUtDLElBQUwsRUFBVztBQUNULFVBQUlDLEtBQUssR0FBRyxJQUFaO0FBQUEsVUFBa0JDLElBQUksR0FBR2IsQ0FBQyxDQUFDLGFBQUQsQ0FBRCxDQUFpQmMsV0FBakIsS0FBaUMsRUFBMUQ7QUFDQTs7O0FBQ0FGLE1BQUFBLEtB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ZUFBRCxFQUFrQixJQUFJVSxJQUFKLEVBQWxCLENBQVA7QUFDRCxDQW5QRCIsInNvdXJjZXNDb250ZW50IjpbImxheXVpLmRlZmluZShbJ2xheWVyJywgJ2Zvcm0nLCAndGFibGUnLCAndXRpbCcsICdhZG1pbicsICd4bVNlbGVjdCcsICdub3RpY2UnXSwgZnVuY3Rpb24gKGV4cG9ydHMpIHtcbiAgbGV0ICQgICAgICAgID0gbGF5dWkuanF1ZXJ5O1xuICBsZXQgbGF5ZXIgICAgPSBsYXl1aS5sYXllcjtcbiAgbGV0IGZvcm0gICAgID0gbGF5dWkuZm9ybTtcbiAgbGV0IHRhYmxlICAgID0gbGF5dWkudGFibGU7XG4gIGxldCB1dGlsICAgICA9IGxheXVpLnV0aWw7XG4gIGxldCBhZG1pbiAgICA9IGxheXVpLmFkbWluO1xuICBsZXQgeG1TZWxlY3QgPSBsYXl1aS54bVNlbGVjdDtcbiAgbGV0IG5vdGljZSAgID0gbGF5dWkubm90aWNlO1xuXG4gIGNsYXNzIFVzZXIge1xuICAgIGluc1RiXG4gICAgd2hlcmUgPSB7fVxuXG4gICAgaW5pdChkYXRhKSB7XG4gICAgICBsZXQgX3RoaXMgPSB0aGlzLCB0b3BIID0gJCgnI3NlYXJjaEZvcm0nKS5vdXRlckhlaWdodCgpICsgNDA7XG4gICAgICAvKiDmuLLmn5PooajmoLwgKi9cbiAgICAgIF90aGlzLmluc1RiID0gdGFibGUucmVuZGVyKHtcbiAgICAgICAgZWxlbSAgICAgICAgICA6ICcjdXNlclRhYmxlJyxcbiAgICAgICAgdXJsICAgICAgICAgICA6IGFkbWluLnVybCgnYmFja2VuZC91c2VyL2xpc3QnKSxcbiAgICAgICAgcGFnZSAgICAgICAgICA6IHRydWUsXG4gICAgICAgIHRvb2xiYXIgICAgICAgOiAkKCcjb3BlcmF0aW9uVG9vbGJhcicpLmh0bWwoKSxcbiAgICAgICAgY2VsbE1pbldpZHRoICA6IDEwMCxcbiAgICAgICAgaGVpZ2h0ICAgICAgICA6ICdmdWxsLScgKyB0b3BILFxuICAgICAgICBkZWZhdWx0VG9vbGJhcjogWydmaWx0ZXInXSxcbiAgICAgICAgYXV0b1JvdyAgICAgICA6IHRydWUsXG4gICAgICAgIGNvbHMgICAgICAgICAgOiBbW1xuICAgICAgICAgIHt0eXBlOiAnY2hlY2tib3gnfSxcbiAgICAgICAgICB7dHlwZTogJ251bWJlcnMnfSxcbiAgICAgICAgICB7ZmllbGQ6ICduYW1lJywgdGl0bGU6ICfotKbmiLcnLCBzb3J0OiBmYWxzZX0sXG4gICAgICAgICAge2ZpZWxkOiAnbmlja25hbWUnLCB0aXRsZTogJ+Wnk+WQjScsIHNvcnQ6IGZhbHNlfSxcbiAgICAgICAgICB7ZmllbGQ6ICdwaG9uZScsIHRpdGxlOiAn5omL5py6Jywgc29ydDogZmFsc2UsIG1pbldpZHRoOiAxMjB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnc3RhdHVzJywgdGl0bGU6ICfnirbmgIEnLCBzb3J0OiBmYWxzZSwgd2lkdGg6IDgwLCB0ZW1wbGV0OiAoZCkgPT4ge1xuICAgICAgICAgICAgICBsZXQgY29sb3IgPSAnIzVGQjg3OCc7XG4gICAgICAgICAgICAgIGlmIChkLnN0YXR1cyA9PT0gMCB8fCBkLnN0YXR1cyA9PT0gMykge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gJyNGRjU3MjInO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBcIjxwIHN0eWxlPSdjb2xvcjpcIiArIGNvbG9yICsgXCInPlwiICsgZC5mb3JtYXRfc3RhdHVzICsgXCI8L3A+XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ3JvbGVzJywgdGl0bGU6ICfop5LoibInLCBtaW5XaWR0aDogMTYwLCBzb3J0OiBmYWxzZSwgdGVtcGxldDogKGQpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIGQucm9sZXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cImxheXVpLWJhZGdlIGxheXVpLWJhZGdlLWdyYXlcIj4nICsgaXRlbSArICc8L3NwYW4+JztcbiAgICAgICAgICAgICAgfSkuam9pbignJm5ic3A7Jm5ic3A7Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2lzX3N1cGVyX3VzZXInLCB0aXRsZTogJ+i2hee6p+euoeeQhuWRmCcsIHdpZHRoOiAxMDAsIHNvcnQ6IGZhbHNlLCB0ZW1wbGV0OiAoZCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gZC5pc19zdXBlcl91c2VyID09PSAxID8gJ+aYrycgOiAn5ZCmJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQgIDogJ2NyZWF0ZV90aW1lJywgdGl0bGU6ICfliJvlu7rml7bpl7QnLCB0ZW1wbGV0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICByZXR1cm4gdXRpbC50b0RhdGVTdHJpbmcoZC5jcmVhdGVfdGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsIHdpZHRoOiAxNjAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7ZmllbGQ6ICdfb3BzJywgdGl0bGU6ICfmk43kvZwnLCB0b29sYmFyOiAnI3VzZXJUYkJhcicsIGFsaWduOiAnY2VudGVyJywgd2lkdGg6IDExMCwgbWluV2lkdGg6IDExMH1cbiAgICAgICAgXV0sXG4gICAgICAgIGxhenkgICAgICAgICAgOiB0cnVlLFxuICAgICAgICBkYXRhICAgICAgICAgIDogZGF0YSxcbiAgICAgICAgd2hlcmUgICAgICAgICA6IHRoaXMud2hlcmVcbiAgICAgIH0pO1xuXG4gICAgICBsZXQgdXNlclJvbGVMaXN0ID0geG1TZWxlY3QucmVuZGVyKHtcbiAgICAgICAgZWwgICAgICAgIDogJyN1c2VyUm9sZUxpc3QnLFxuICAgICAgICBoZWlnaHQgICAgOiAnMjUwcHgnLFxuICAgICAgICByYWRpbyAgICAgOiB0cnVlLFxuICAgICAgICBkYXRhICAgICAgOiBbXSxcbiAgICAgICAgaW5pdFZhbHVlIDogW10sXG4gICAgICAgIHRpcHMgICAgICA6ICfor7fpgInmi6nnlKjmiLfop5LoibInLFxuICAgICAgICBuYW1lICAgICAgOiAncm9sZUlkJyxcbiAgICAgICAgcHJvcCAgICAgIDoge1xuICAgICAgICAgIG5hbWUgOiAncm9sZScsXG4gICAgICAgICAgdmFsdWU6ICdpZCdcbiAgICAgICAgfSxcbiAgICAgICAgY2xpY2tDbG9zZTogdHJ1ZSxcbiAgICAgICAgbGF5VmVyVHlwZTogJ3RpcHMnLFxuICAgICAgICBtb2RlbCAgICAgOiB7XG4gICAgICAgICAgaWNvbiA6ICdoaWRkZW4nLFxuICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBhZG1pbi5nZXQoJ2JhY2tlbmQvcm9sZS9saXN0P2lkPTAnKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHVzZXJSb2xlTGlzdC51cGRhdGUoe1xuICAgICAgICAgIGRhdGEgICA6IGRhdGEudHJlZSxcbiAgICAgICAgICB0cmVlICAgOiB7XG4gICAgICAgICAgICBzaG93ICAgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgICAgIHNob3dGb2xkZXJJY29uOiB0cnVlLFxuICAgICAgICAgICAgaW5kZW50ICAgICAgICA6IDE1LFxuICAgICAgICAgICAgc3RyaWN0ICAgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgZXhwYW5kZWRLZXlzICA6IFsxXSxcbiAgICAgICAgICAgIHNpbXBsZSAgICAgICAgOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYXV0b1JvdzogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuXG4gICAgICAvKiDooajmoLzmkJzntKIgKi9cbiAgICAgIGZvcm0ub24oJ3N1Ym1pdCh1c2VyVGJTZWFyY2gpJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgX3RoaXMud2hlcmUgPSAkLmV4dGVuZChfdGhpcy53aGVyZSwgZGF0YS5maWVsZClcbiAgICAgICAgX3RoaXMuaW5zVGIucmVsb2FkRGF0YSgpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICAvKiDooajmoLzlt6XlhbfmnaHngrnlh7vkuovku7YgKi9cbiAgICAgIHRhYmxlLm9uKCd0b29sKHVzZXJUYWJsZSknLCBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIGxldCBldmVudCA9IG9iai5ldmVudFxuICAgICAgICBsZXQgdXNlciAgPSBvYmouZGF0YVxuICAgICAgICBpZiAoZXZlbnQgPT09ICdlZGl0Jykge1xuICAgICAgICAgIF90aGlzLnNob3dFZGl0TW9kZWwodXNlcik7XG4gICAgICAgIH0gZWxzZSBpZiAob2JqLmV2ZW50ID09PSAnZGVsJykge1xuICAgICAgICAgIHVzZXIuaXNfc3VwZXJfdXNlciA9PT0gMSA/IG5vdGljZS5lcnJvcign6LaF57qn566h55CG5ZGY5LiN6IO96KKr5Yig6ZmkIScpIDogX3RoaXMuZG9EZWwoe3VpZHM6IFt1c2VyLmlkXX0pXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvKiDooajmoLzlpLTlt6XlhbfmoI/ngrnlh7vkuovku7YgKi9cbiAgICAgIHRhYmxlLm9uKCd0b29sYmFyKHVzZXJUYWJsZSknLCBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIGxldCBldmVudCAgICAgPSBvYmouZXZlbnRcbiAgICAgICAgbGV0IGNoZWNrUm93cyA9IHRhYmxlLmNoZWNrU3RhdHVzKCd1c2VyVGFibGUnKS5kYXRhXG4gICAgICAgIGlmIChldmVudCA9PT0gJ2FkZCcpIHtcbiAgICAgICAgICBfdGhpcy5zaG93RWRpdE1vZGVsKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09ICdkZWwnKSB7XG4gICAgICAgICAgaWYgKGNoZWNrUm93cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIG5vdGljZS5lcnJvcign6K+36YCJ5oup6KaB5Yig6Zmk55qE55So5oi3Jyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGxldCBpZHMgPSBjaGVja1Jvd3MubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZC5pZDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBfdGhpcy5kb0RlbCh7dWlkczogaWRzfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy/lr4bnoIHmoYZzd2l0Y2jnm5HlkKxcbiAgICAgIGZvcm0ub24oJ3N3aXRjaChzdGF0dXMpJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgbGV0IHN0YXR1cyAgICAgID0gZGF0YS5lbGVtLmNoZWNrZWQgPyAyIDogMVxuICAgICAgICBkYXRhLmVsZW0udmFsdWUgPSBzdGF0dXNcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qIOaYvuekuuihqOWNleW8ueeqlyAqL1xuICAgIHNob3dFZGl0TW9kZWwobURhdGEpIHtcbiAgICAgIGxldCBpbnNUYiA9IHRoaXMuaW5zVGJcbiAgICAgIGxldCB0aXRsZSA9IChtRGF0YSA/ICfkv67mlLknIDogJ+a3u+WKoCcpICsgJ+eUqOaItydcbiAgICAgIGxldCB1cmwgICA9IG1EYXRhID8gJ2JhY2tlbmQvdXNlci9zYXZlJyA6ICdiYWNrZW5kL3VzZXIvYWRkJ1xuICAgICAgYWRtaW4ub3Blbih7XG4gICAgICAgIHR5cGUgICA6IDEsXG4gICAgICAgIGFyZWEgICA6ICc2ODBweCcsXG4gICAgICAgIHRpdGxlICA6IHRpdGxlLFxuICAgICAgICBjb250ZW50OiAkKCcjdXNlckVkaXREaWFsb2cnKS5odG1sKCksXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChsYXllcm8sIGRJbmRleCkge1xuICAgICAgICAgIGxldCBkb20gPSAkKCcjcGFzc3dkJylcbiAgICAgICAgICBpZiAoIW1EYXRhKSB7XG4gICAgICAgICAgICBkb20uY2hpbGRyZW4oJ2xhYmVsLmxheXVpLWZvcm0tbGFiZWwnKS5hZGRDbGFzcygnbGF5dWktZm9ybS1yZXF1aXJlZCcpXG4gICAgICAgICAgICAkKCcjcGFzc3dkSW5wdXQnKVswXS5zZXRBdHRyaWJ1dGUoJ2xheS12ZXJpZnknLCAncmVxdWlyZWQnKVxuICAgICAgICAgICAgJChsYXllcm8pLmZpbmQoJyNzZXRVc2VyU3RhdHVzJykucmVtb3ZlKClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJChsYXllcm8pLmZpbmQoJyNyZXNldE9uRmlyc3RMb2dpbicpLnJlbW92ZSgpXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIOWbnuaYvuihqOWNleaVsOaNrlxuICAgICAgICAgIGZvcm0udmFsKCd1c2VyRWRpdEZvcm0nLCBtRGF0YSk7XG4gICAgICAgICAgLy8g6KGo5Y2V5o+Q5Lqk5LqL5Lu2XG4gICAgICAgICAgZm9ybS5vbignc3VibWl0KHVzZXJFZGl0U3VibWl0KScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBkYXRhLmZpZWxkLnVpZCA9IG1EYXRhID8gbURhdGEuaWQgOiAnJztcbiAgICAgICAgICAgIHZhciBsb2FkSW5kZXggID0gbGF5ZXIubG9hZCgyKTtcbiAgICAgICAgICAgIGFkbWluLnBvc3QodXJsLCBkYXRhLmZpZWxkKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChkYXRhLmNvZGUgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgIGxheWVyLmNsb3NlKGRJbmRleCk7XG4gICAgICAgICAgICAgICAgbm90aWNlLnN1Y2Nlc3ModGl0bGUgKyAn5oiQ5YqfJylcbiAgICAgICAgICAgICAgICBpbnNUYi5yZWxvYWQoKVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5vdGljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5mYWlsKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgIG5vdGljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGxheWVyLmNsb3NlKGxvYWRJbmRleCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgLy8g5riy5p+T5aSa6YCJ5LiL5ouJ5qGGXG4gICAgICAgICAgbGV0IGluc1JvbGVTZWwgPSB4bVNlbGVjdC5yZW5kZXIoe1xuICAgICAgICAgICAgZWwgICAgICAgIDogJyN1c2VyRWRpdFJvbGVTZWwnLFxuICAgICAgICAgICAgaGVpZ2h0ICAgIDogJzI1MHB4JyxcbiAgICAgICAgICAgIGRhdGEgICAgICA6IFtdLFxuICAgICAgICAgICAgaW5pdFZhbHVlIDogbURhdGEgPyBtRGF0YS5yb2xlSWRzIDogW10sXG4gICAgICAgICAgICB0aXBzICAgICAgOiAn6K+36YCJ5oup55So5oi36KeS6ImyJyxcbiAgICAgICAgICAgIG5hbWUgICAgICA6ICdyb2xlSWRzJyxcbiAgICAgICAgICAgIHByb3AgICAgICA6IHtcbiAgICAgICAgICAgICAgbmFtZSA6ICdyb2xlJyxcbiAgICAgICAgICAgICAgdmFsdWU6ICdpZCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGlja0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgbGF5VmVyaWZ5IDogJ3JlcXVpcmVkJyxcbiAgICAgICAgICAgIGxheVZlclR5cGU6ICd0aXBzJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhZG1pbi5nZXQoJ2JhY2tlbmQvcm9sZS9saXN0P2lkPTAnKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpbnNSb2xlU2VsLnVwZGF0ZSh7XG4gICAgICAgICAgICAgIGRhdGEgICA6IGRhdGEudHJlZSxcbiAgICAgICAgICAgICAgdHJlZSAgIDoge1xuICAgICAgICAgICAgICAgIHNob3cgICAgICAgICAgOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNob3dGb2xkZXJJY29uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGluZGVudCAgICAgICAgOiAxNSxcbiAgICAgICAgICAgICAgICBzdHJpY3QgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXhwYW5kZWRLZXlzICA6IFsxXSxcbiAgICAgICAgICAgICAgICBzaW1wbGUgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYXV0b1JvdzogdHJ1ZSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgLy8g56aB5q2i5by556qX5Ye6546w5rua5Yqo5p2hXG4gICAgICAgICAgJChsYXllcm8pLmNoaWxkcmVuKCcubGF5dWktbGF5ZXItY29udGVudCcpLmNzcygnb3ZlcmZsb3cnLCAndmlzaWJsZScpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBkb0RlbChvYmopIHtcbiAgICAgIGxldCBpbnNUYiA9IHRoaXMuaW5zVGJcbiAgICAgIGxheWVyLmNvbmZpcm0oJ+ehruWumuimgeWIoOmZpOmAieS4reeahOeUqOaIt+WQl++8nycsIHtcbiAgICAgICAgc2tpbiA6ICdsYXl1aS1sYXllci1hZG1pbicsXG4gICAgICAgIHNoYWRlOiAuMVxuICAgICAgfSwgZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgbGF5ZXIuY2xvc2UoaSk7XG4gICAgICAgIGxldCBsb2FkSW5kZXggPSBsYXllci5sb2FkKDIpO1xuICAgICAgICBhZG1pbi5wb3N0KCdiYWNrZW5kL3VzZXIvZGVsJywgb2JqKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgbGF5ZXIuY2xvc2UobG9hZEluZGV4KTtcbiAgICAgICAgICBpZiAoZGF0YS5jb2RlID09PSAyMDApIHtcbiAgICAgICAgICAgIG5vdGljZS5zdWNjZXNzKCfliKDpmaTnlKjmiLfmiJDlip8nKTtcbiAgICAgICAgICAgIGluc1RiLnJlbG9hZCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub3RpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pLmZhaWwoKGRhdGEpID0+IHtcbiAgICAgICAgICBub3RpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGV4cG9ydHMoJ0BiYWNrZW5kLnVzZXInLCBuZXcgVXNlcik7XG59KTsiXSwiZmlsZSI6InVzZXIuanMifQ==
