/** wulacms-v3.0.0 MIT License By https://github.com/ninggf/wulacms */
 ;function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}layui.define(["layer","form","util","admin","zTree","xmSelect","treeTable","notice"],function(e){var a=layui.jquery,d=layui.layer,s=layui.form,o=layui.treeTable,c=layui.admin,u=layui.notice,f=layui.xmSelect,r=top.layui.index;e("@backend.role",new(function(){function e(){_defineProperty(this,"insTb",void 0)}var t=e.prototype;return t.init=function(){this.insTb=o.render({elem:"#roleTable",url:c.url("backend/role/list"),id:"roleList",page:!0,toolbar:a("#operationToolbar").html(),defaultToolbar:["filter"],cellMinWidth:100,cols:[[{type:"checkbox"},{type:"numbers",title:"序号",width:80},{field:"role",title:"角色名称",sort:!1},{field:"name",title:"角色代码",sort:!1},{field:"remark",title:"备注",sort:!1},{field:"_ops",title:"操作",toolbar:"#roleTbBar",align:"center",width:140,minWidth:140}]],text:{none:'<div style="padding: 18px 0;">哎呀，当前无角色数据,快去添加吧~</div>'},tree:{openName:"role",iconIndex:2,idName:"id",pidName:"pid",isPidData:!0,arrowType:"arrow2",getIcon:function(e){return'<i class="ew-tree-icon"></i>'}}});var i=this;s.on("submit(roleTbSearch)",function(e){return i.insTb.reload({where:e.field,page:{curr:1}}),!1}),o.on("tool(roleTable)",function(e){var t=e.data.id;switch(e.event){case"edit":i.showEditModel(e.data);break;case"del":i.doDel({ids:[t]});break;case"auth":r.openTab({url:c.url("backend/role/grant?rid="+t),title:e.data.role+"权限",end:""})}}),o.on("toolbar(roleTable)",function(e){"add"===e.event?i.showEditModel():"del"===e.event&&(0!==(e=i.insTb.checkStatus("roleList")).length?(e=e.map(function(e){return e.id}),i.doDel({ids:e})):d.msg("请选择要删除的角色",{icon:2}))})},t.showEditModel=function(r){var l=this.insTb,n=c.url(r?"backend/role/save":"backend/role/add");c.open({type:1,area:"600px",offset:10,title:(r?"修改":"添加")+"角色",content:a("#roleEditDialog").html(),success:function(e,o){s.val("roleEditForm",r),s.on("submit(roleEditSubmit)",function(e){var i=d.load(2);return c.post(c.url(n),e.field).then(function(e){var t;d.close(i),200===e.code?(d.close(o),t=r?"修改":"添加",u.success("角色"+t+"成功"),l.refresh()):u.error(e.message)}).fail(function(e){d.close(i),u.error(e.message)}),!1});var i=f.render({el:"#rolesEditParentSel",height:"250px",data:[],tips:"请选择上级角色",name:"pid",initValue:r?[r.pid]:[0],model:{label:{type:"text"}},prop:{name:"role",value:"id"},radio:!0,clickClose:!0}),t=r?r.id:0;c.get("backend/role/list?id="+t).then(function(e){var t=[];t.push({role:"无",id:0}),t=t.concat(e.tree),i.update({data:t,tree:{show:!0,showFolderIcon:!0,indent:15,strict:!1,expandedKeys:[1],simple:!0},autoRow:!0})}),a(e).children(".layui-layer-content").css("overflow","visible")}})},t.doDel=function(i){var o=this.insTb;d.confirm("确定要删除选中的角色吗？",{skin:"layui-layer-admin",shade:.1},function(e){d.close(e);var t=d.load(2);c.post("backend/role/del",i).then(function(e){d.close(t),200===e.code?(u.success("角色删除成功"),o.refresh()):u.error(e.message)}).fail(function(e){d.close(t),u.error(e.message)})})},e}()))});