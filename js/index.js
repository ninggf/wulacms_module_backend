/** wulacms-v3.0.0 MIT License By https://www.wulacms.com */
 ;layui.define(["&coolay","jquery","element"],function(t){"use strict";var s=layui.$,n=layui["&coolay"],i=layui.element;t("@backend.index",{init:function(t){new Vue({el:"#index",data:{menu:{show:0,listshow:0,search_focus:0,module_show:0,collection_list:[],menu_list:t.naviCfg.menu,res_list:{title:"搜索结果",lists:[]},current_menu:-1},links:t.naviCfg.tmenu,notice:{data:t.naviCfg.notice,list_show:0,list:[]},cart:t.naviCfg.cart,faq:t.naviCfg.faq,uMeta:t.uMeta,pMeta:t.pMeta,path:t.path,drop:{start:"",target:"",current:-1},ajax:{error:0,success:0,request:null},search:{search_val:"",t:"",res:[]},nav:{search_val:"",show:0},vm:null},methods:{collection:function(e){var t;e.isadd?(t=this.menu.collection_list.findIndex(function(t){return t.name==e.name}),this.menu.collection_list.splice(t,1)):this.menu.collection_list.push(e),e.isadd=!e.isadd},dragstart:function(t){this.drop.start=t},dragend:function(){var t,e,n=this;this.drop.start.name!=this.drop.target.name&&(t=this.menu.collection_list.findIndex(function(t){return t.name==n.drop.start.name}),e=this.menu.collection_list.findIndex(function(t){return t.name==n.drop.target.name}),this.menu.collection_list.splice(t,1,this.drop.target),this.menu.collection_list.splice(e,1,this.drop.start),this.drop.current=-1)},dragenter:function(e){this.drop.current=this.menu.collection_list.findIndex(function(t){return t.name==e.name}),this.drop.target=e},clickMenu:function(t){if(-1!=t.url.indexOf("#"))this.getComp(t.url);else{if(location.pathname==t.url&&!location.hash)return;this.getHtml(t)}this.menu.show=this.menu.listshow=0,history.pushState({comp:t},t.url,t.url),s("#module").hide()},doSearch:function(t){this.nav.show=1,s(".nav-right .search").trigger("dosearch",{val:this.nav.search_val})},searchMenu:function(t){var a=this;a.search.search_val?(a.search.t&&(window.clearTimeout(a.search.t),a.search.t=0),a.search.t=setTimeout(function(){a.search.t=0,a.search.res=[],a.search.res=a.menu.menu_list.map(function(t,e,n){return n=t.lists.filter(function(t){return t.name.includes(a.search.search_val)}),{title:t.title,lists:n}}),a.search.res=a.search.res.filter(function(t){return t.lists.length})},800)):a.search.res=[]},getComp:function(t){var e=t.replace("#","@").replace("/","."),n=this;layui.use(e,function(t){s("#workspace").html(t.tpl),t.vue.el="#workspace",n.vm=new Vue(t.vue)})},getHtml:function(e){var a=this;this.ajax.request=s.ajax({url:e.url,method:"GET",timeout:5e3,dataType:"html",beforeSend:function(t){t.setRequestHeader("PJAX","1"),a.ajax.error=0,a.ajax.success=0,s(".layui-progress").show(),i.progress("install-progress","0")},success:function(t){var e=s("#workspace");window.vueVm&&window.vueVm.$destroy(),e.html(t),i.progress("install-progress","100%")},complete:function(t){n.setPageTitle(t.getResponseHeader("PageTitle")),setTimeout(function(){i.progress("install-progress","0"),s(".layui-progress").hide(),a.ajax.error=0},2e3),e.url==a.path.backend.url&&s("#module").show(),a.ajax.request=null},error:function(n){new Promise(function(t,e){setTimeout(function(){s("#workspace").html(n.responseText),i.progress("install-progress","100%"),a.ajax.error=1,e(n)},500)}).catch(function(t){a.doStatus(t.status)})}})},doStatus:function(t){var e=this;401==t&&layer.msg("登录失败请重新登录",{time:2e3},function(){e.path.login.cb?e.path.login.cb():location.href=e.path.login.url}),403!=t||layer.msg("账号权限不够")},goHome:function(){var t=this;location.pathname+location.hash!=t.path.backend.url&&(this.getHtml({url:t.path.backend.url}),history.pushState({comp:{url:t.path.backend.url}},t.path.backend.url,t.path.backend.url))},showNotice:function(){this.notice.data.new&&(this.notice.list_show=1)}},mounted:function(){var e=this;window.location.hash?(history.pushState({comp:{url:window.location.hash}},window.location.hash,window.location.hash),e.getComp(window.location.hash)):history.pushState({comp:{url:location.pathname}},location.pathname,location.pathname),window.onpopstate=function(t){e.ajax.request&&e.ajax.request.abort(),t.state?-1!=t.state.comp.url.indexOf("#")?e.getComp(window.location.hash):e.getHtml(t.state.comp):window.location.hash&&e.getComp(window.location.hash)}}})}})});