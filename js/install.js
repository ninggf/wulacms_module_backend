layui.define(['jquery'], function (exports) {
  'use strict';

  var $ = layui.$;
  var app = new Vue({
    el: '#install',
    data: {
      // 环境监测 
      step: [{
        title: '环境检测',
        name: 'home'
      }, {
        title: '安全码验证',
        name: 'verify'
      }, {
        title: '环境选择',
        name: 'config'
      }, {
        title: '数据库配置',
        name: 'db'
      }, {
        title: '创建管理员',
        name: 'user'
      }, {
        title: '安装',
        name: 'install'
      }],
      requirements: window.vueData.requirements,
      dirs: window.vueData.dirs,
      page_step: window.vueData.step,
      page_data: window.vueData.data,
      status: 0,
      //0提交验证 1验证中 //2验证通过//3禁止
      current: 'home',
      install_progress: 0,
      tips: "",
      progress: {
        percent: 0,
        list: []
      },
      verify: {
        code: ''
      },
      config: {
        config: 'pro'
      },
      db: {
        type: 'MYSQL',
        dbname: '',
        dbusername: '',
        dbpwd: '',
        host: '',
        port: '',
        prefix: '',
        persistent: 0
      },
      user: {
        name: '',
        pwd: '',
        confirm_pwd: '',
        url: 'backend'
      },
      url1: '',
      url2: ''
    },
    methods: {
      verifyNext: function verifyNext() {
        var flag = 1;
        this.requirements.map(function (v) {
          if (!(v[1].pass | v[1].optional)) flag = 0;
        });
        this.dirs.map(function (v) {
          if (!(v[1].pass | v[1].optional)) flag = 0;
        });
        return flag;
      },
      go: function go(type) {
        if (!type) return;
        var $vm = this;
        $vm.tips = '';
        $vm.status = 0;
        $("input").removeClass("tips");

        for (var i = 0; i < $vm.step.length; i++) {
          if ($vm.step[i].name == $vm.current) {
            $vm.current = type == 'next' ? $vm.step[i + 1].name : $vm.step[i - 1].name;

            if ($vm.current == 'install') {
              $vm.doInstall();
            }

            return;
          }
        }
      },
      removeTips: function removeTips(name) {
        $("input." + name).removeClass("tips");
      },
      setup: function setup(name) {
        var $vm = this,
            api = "installer/setup",
            tips_arr = [];
        this.status = 1; // 本地检查input填写

        if (name == "db" || name == "user") {
          for (var i in $vm[name]) {
            if (!$vm[name][i] && i != "port" && i != "host" && i != "persistent") {
              tips_arr.push('input.' + i);
            }
          }

          while (tips_arr.length) {
            $(tips_arr.shift()).addClass('tips');

            if (tips_arr.length == 0) {
              $vm.status = 0;
              return;
            }
          }
        }

        if (name == 'verify') {
          api = 'installer/verify';
        }

        $.post(api, api == "installer/setup" ? {
          step: name,
          cfg: $vm[name]
        } : {
          step: name,
          code: $vm.verify.code
        }, function (data) {
          if (data && data.status) {
            $vm.status = 1;
            $vm.go('next');
          } else {
            $vm.current = data.step;
            $vm.tips = data.msg || 'tips';
            $vm.status = 0;
          }
        });
      },
      doInstall: function doInstall() {
        var $vm = this,
            response_len = false,
            data = null;
        $.get({
          url: 'installer/install',
          timeout: 3000000,
          dataType: 'text',
          xhrFields: {
            onprogress: function onprogress(e) {
              var response,
                  resp = e.currentTarget.response;

              if (response_len === false) {
                response = resp;
                response_len = resp.length;
              } else {
                response = resp.substring(response_len);
                response_len = resp.length;
              }

              var responses = response.replace(/\}\{/g, '}]-[{').split(']-[');
              responses.forEach(function (res) {
                $vm.installLog(res, $vm);
              });
            }
          }
        }, function (data) {
          $vm.url1 = $vm.progress.list[$vm.progress.list.length - 1]['url'][0];
          $vm.url2 = $vm.progress.list[$vm.progress.list.length - 1]['url'][1];
          console.log('install is done');
        });
      },
      installLog: function installLog(response, $vm) {
        var data = JSON.parse(response);
        var flag = 0;

        if (data.status == 0) {
          $vm.install_progress = -1;
        }

        if ($vm.progress.list.length) {
          for (var i = 0; i < $vm.progress.list.length; i++) {
            var item = $vm.progress.list[i];

            if (data && item.step == data.step && data.done == 1) {
              $vm.progress.list.splice(i, 1, data);
              flag = 1;
            }
          }

          if (!flag) {
            $vm.progress.list.push(data);
          }

          $vm.install_progress = $vm.progress.list[$vm.progress.list.length - 1].percent;
          layui.element.progress('install-progress', $vm.install_progress + '%');
        } else {
          $vm.progress.list.push(data);
        }
      }
    },
    mounted: function mounted() {
      if (this.page_step) {
        for (var i in this.page_data) {
          if (this.page_data[i] && this[i]) this[i] = this.page_data[i];
        }

        this.current = this.page_step;
      }
    },
    watch: {
      'db.prefix': {
        handler: function handler(newVal, oldVal) {
          this.db.prefix = this.db.prefix.replace(/[^A-Za-z]/g, '');
        }
      }
    }
  });
  exports('@backend.install', app);
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3RhbGwuanMiXSwibmFtZXMiOlsibGF5dWkiLCJkZWZpbmUiLCJleHBvcnRzIiwiJCIsImFwcCIsIlZ1ZSIsImVsIiwiZGF0YSIsInN0ZXAiLCJ0aXRsZSIsIm5hbWUiLCJyZXF1aXJlbWVudHMiLCJ3aW5kb3ciLCJ2dWVEYXRhIiwiZGlycyIsInBhZ2Vfc3RlcCIsInBhZ2VfZGF0YSIsInN0YXR1cyIsImN1cnJlbnQiLCJpbnN0YWxsX3Byb2dyZXNzIiwidGlwcyIsInByb2dyZXNzIiwicGVyY2VudCIsImxpc3QiLCJ2ZXJpZnkiLCJjb2RlIiwiY29uZmlnIiwiZGIiLCJ0eXBlIiwiZGJuYW1lIiwiZGJ1c2VybmFtZSIsImRicHdkIiwiaG9zdCIsInBvcnQiLCJwcmVmaXgiLCJwZXJzaXN0ZW50IiwidXNlciIsInB3ZCIsImNvbmZpcm1fcHdkIiwidXJsIiwidXJsMSIsInVybDIiLCJtZXRob2RzIiwidmVyaWZ5TmV4dCIsImxldCIsImZsYWciLCJtYXAiLCJ2IiwicGFzcyIsIm9wdGlvbmFsIiwiZ28iLCIkdm0iLCJyZW1vdmVDbGFzcyIsImkiLCJsZW5ndGgiLCJkb0luc3RhbGwiLCJyZW1vdmVUaXBzIiwic2V0dXAiLCJhcGkiLCJ0aXBzX2FyciIsInB1c2giLCJzaGlmdCIsImFkZENsYXNzIiwicG9zdCIsImNmZyIsIm1zZyIsInJlc3BvbnNlX2xlbiIsImdldCIsInRpbWVvdXQiLCJkYXRhVHlwZSIsInhockZpZWxkcyIsIm9ucHJvZ3Jlc3MiLCJlIiwicmVzcG9uc2UiLCJyZXNwIiwiY3VycmVudFRhcmdldCIsInN1YnN0cmluZyIsInJlc3BvbnNlcyIsInJlcGxhY2UiLCJzcGxpdCIsImZvckVhY2giLCJyZXMiLCJpbnN0YWxsTG9nIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJwYXJzZSIsIml0ZW0iLCJkb25lIiwic3BsaWNlIiwiZWxlbWVudCIsIm1vdW50ZWQiLCJ3YXRjaCIsImhhbmRsZXIiLCJuZXdWYWwiLCJvbGRWYWwiXSwibWFw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QUEsS0FBSyxFQUFDO0FBQ0YsbUJBQVk7QUFDVEMsUUFBQUEsT0FBTyxFQUFDLGlCQUFTQyxNQUFULEVBQWdCQyxNQUFoQixFQUF1QjtBQUMzQixlQUFLcEUsRUFBTCxDQUFRTyxNQUFSLEdBQWtCLEtBQUtQLEVBQUwsQ0FBUU8sTUFBUixDQUFlNEMsT0FBZixDQUF1QixZQUF2QixFQUFvQyxFQUFwQyxDQUFsQjtBQUNKO0FBSFM7QUFEVjtBQS9MVSxHQUFSLENBQVo7QUF3TUE1RSxFQUFBQSxPQUFPLENBQUMsa0JBQUQsRUFBcUJFLEdBQXJCLENBQVBGO0FBQ0gsQ0E1TURGIiwiZmlsZSI6Imluc3RhbGwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJsYXl1aS5kZWZpbmUoWydqcXVlcnknXSwgKGV4cG9ydHMpID0+IHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGNvbnN0ICQgICA9IGxheXVpLiQ7XHJcbiAgICBjb25zdCBhcHAgPSBuZXcgVnVlKHtcclxuICAgICAgICBlbCAgICAgOiAnI2luc3RhbGwnLFxyXG4gICAgICAgIGRhdGEgICA6IHtcclxuICAgICAgICAgICAgLy8g546v5aKD55uR5rWLIFxyXG4gICAgICAgICAgICBzdGVwICAgICAgICAgICAgOiBbXHJcbiAgICAgICAgICAgICAgICB7dGl0bGU6ICfnjq/looPmo4DmtYsnLCBuYW1lOiAnaG9tZSd9LFxyXG4gICAgICAgICAgICAgICAge3RpdGxlOiAn5a6J5YWo56CB6aqM6K+BJywgbmFtZTogJ3ZlcmlmeSd9LFxyXG4gICAgICAgICAgICAgICAge3RpdGxlOiAn546v5aKD6YCJ5oupJywgbmFtZTogJ2NvbmZpZyd9LFxyXG4gICAgICAgICAgICAgICAge3RpdGxlOiAn5pWw5o2u5bqT6YWN572uJywgbmFtZTogJ2RiJ30sXHJcbiAgICAgICAgICAgICAgICB7dGl0bGU6ICfliJvlu7rnrqHnkIblkZgnLCBuYW1lOiAndXNlcid9LFxyXG4gICAgICAgICAgICAgICAge3RpdGxlOiAn5a6J6KOFJywgbmFtZTogJ2luc3RhbGwnfSxcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgcmVxdWlyZW1lbnRzICAgIDogd2luZG93LnZ1ZURhdGEucmVxdWlyZW1lbnRzLFxyXG4gICAgICAgICAgICBkaXJzICAgICAgICAgICAgOiB3aW5kb3cudnVlRGF0YS5kaXJzLFxyXG4gICAgICAgICAgICBwYWdlX3N0ZXAgICAgICAgOiB3aW5kb3cudnVlRGF0YS5zdGVwLFxyXG4gICAgICAgICAgICBwYWdlX2RhdGEgICAgICAgOiB3aW5kb3cudnVlRGF0YS5kYXRhLFxyXG4gICAgICAgICAgICBzdGF0dXMgICAgICAgICAgOiAwLC8vMOaPkOS6pOmqjOivgSAx6aqM6K+B5LitIC8vMumqjOivgemAmui/hy8vM+emgeatolxyXG4gICAgICAgICAgICBjdXJyZW50ICAgICAgICAgOiAnaG9tZScsXHJcbiAgICAgICAgICAgIGluc3RhbGxfcHJvZ3Jlc3M6IDAsXHJcbiAgICAgICAgICAgIHRpcHMgICAgICAgICAgICA6IFwiXCIsXHJcbiAgICAgICAgICAgIHByb2dyZXNzOntcclxuICAgICAgICAgICAgICAgIHBlcmNlbnQ6MCxcclxuICAgICAgICAgICAgICAgIGxpc3Q6W10sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHZlcmlmeSAgICAgICAgICA6IHtcclxuICAgICAgICAgICAgICAgIGNvZGU6ICcnLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb25maWcgICAgICAgICAgOiB7XHJcbiAgICAgICAgICAgICAgICBjb25maWc6ICdwcm8nLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBkYiAgICAgICAgICAgICAgOiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlICAgICAgOiAnTVlTUUwnLFxyXG4gICAgICAgICAgICAgICAgZGJuYW1lICAgIDogJycsXHJcbiAgICAgICAgICAgICAgICBkYnVzZXJuYW1lOiAnJyxcclxuICAgICAgICAgICAgICAgIGRicHdkICAgICA6ICcnLFxyXG4gICAgICAgICAgICAgICAgaG9zdCAgICAgIDogJycsXHJcbiAgICAgICAgICAgICAgICBwb3J0ICAgICAgOiAnJyxcclxuICAgICAgICAgICAgICAgIHByZWZpeCAgICA6ICcnLFxyXG4gICAgICAgICAgICAgICAgcGVyc2lzdGVudDogMCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdXNlciAgICAgICAgICAgIDoge1xyXG4gICAgICAgICAgICAgICAgbmFtZSAgICAgICA6ICcnLFxyXG4gICAgICAgICAgICAgICAgcHdkICAgICAgICA6ICcnLFxyXG4gICAgICAgICAgICAgICAgY29uZmlybV9wd2Q6ICcnLFxyXG4gICAgICAgICAgICAgICAgdXJsICAgICAgICA6ICdiYWNrZW5kJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB1cmwxOicnLFxyXG4gICAgICAgICAgICB1cmwyOicnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWV0aG9kczoge1xyXG4gICAgICAgICAgICB2ZXJpZnlOZXh0KCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGZsYWcgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1aXJlbWVudHMubWFwKGZ1bmN0aW9uICh2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodlsxXS5wYXNzIHwgdlsxXS5vcHRpb25hbCkpIGZsYWcgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpcnMubWFwKGZ1bmN0aW9uICh2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodlsxXS5wYXNzIHwgdlsxXS5vcHRpb25hbCkpIGZsYWcgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmxhZztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZ28odHlwZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdHlwZSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCAkdm0gICAgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgJHZtLnRpcHMgICA9ICcnO1xyXG4gICAgICAgICAgICAgICAgJHZtLnN0YXR1cyA9IDA7XHJcbiAgICAgICAgICAgICAgICAkKFwiaW5wdXRcIikucmVtb3ZlQ2xhc3MoXCJ0aXBzXCIpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkdm0uc3RlcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkdm0uc3RlcFtpXS5uYW1lID09ICR2bS5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR2bS5jdXJyZW50ID0gdHlwZSA9PSAnbmV4dCcgPyAkdm0uc3RlcFtpICsgMV0ubmFtZSA6ICR2bS5zdGVwW2kgLSAxXS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2bS5jdXJyZW50ID09ICdpbnN0YWxsJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZtLmRvSW5zdGFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJlbW92ZVRpcHMobmFtZSkge1xyXG4gICAgICAgICAgICAgICAgJChcImlucHV0LlwiICsgbmFtZSkucmVtb3ZlQ2xhc3MoXCJ0aXBzXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgc2V0dXAobmFtZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyICR2bSAgICAgPSB0aGlzLCBhcGkgPSBcImluc3RhbGxlci9zZXR1cFwiLCB0aXBzX2FyciA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSAxO1xyXG4gICAgICAgICAgICAgICAgLy8g5pys5Zyw5qOA5p+laW5wdXTloavlhplcclxuICAgICAgICAgICAgICAgIGlmIChuYW1lID09IFwiZGJcIiB8fCBuYW1lID09IFwidXNlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiAkdm1bbmFtZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdm1bbmFtZV1baV0gJiYgaSAhPSBcInBvcnRcIiAmJiBpICE9IFwiaG9zdFwiICYmIGkgIT0gXCJwZXJzaXN0ZW50XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpcHNfYXJyLnB1c2goJ2lucHV0LicgKyBpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAodGlwc19hcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGlwc19hcnIuc2hpZnQoKSkuYWRkQ2xhc3MoJ3RpcHMnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpcHNfYXJyLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdm0uc3RhdHVzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gJ3ZlcmlmeScpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcGkgPSAnaW5zdGFsbGVyL3ZlcmlmeSc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkLnBvc3QoYXBpLCBhcGkgPT0gXCJpbnN0YWxsZXIvc2V0dXBcIiA/IHtzdGVwOiBuYW1lLCBjZmc6ICR2bVtuYW1lXX0gOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RlcDogbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBjb2RlOiAkdm0udmVyaWZ5LmNvZGVcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHZtLnN0YXR1cyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR2bS5nbygnbmV4dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR2bS5jdXJyZW50ID0gZGF0YS5zdGVwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdm0udGlwcyAgICA9IGRhdGEubXNnIHx8ICd0aXBzJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHZtLnN0YXR1cyAgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBkb0luc3RhbGwoKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgJHZtID0gdGhpcywgcmVzcG9uc2VfbGVuID0gZmFsc2UsIGRhdGEgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgJC5nZXQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHVybCAgICAgIDogJ2luc3RhbGxlci9pbnN0YWxsJyxcclxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ICA6IDMwMDAwMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGUgOiAndGV4dCcsXHJcbiAgICAgICAgICAgICAgICAgICAgeGhyRmllbGRzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ucHJvZ3Jlc3M6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2UsIHJlc3AgPSBlLmN1cnJlbnRUYXJnZXQucmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VfbGVuID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlICAgICA9IHJlc3A7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfbGVuID0gcmVzcC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlICAgICA9IHJlc3Auc3Vic3RyaW5nKHJlc3BvbnNlX2xlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfbGVuID0gcmVzcC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2VzID0gcmVzcG9uc2UucmVwbGFjZSgvXFx9XFx7L2csJ31dLVt7Jykuc3BsaXQoJ10tWycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcy5mb3JFYWNoKHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2bS5pbnN0YWxsTG9nKHJlcywkdm0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICR2bS51cmwxPSR2bS5wcm9ncmVzcy5saXN0WyR2bS5wcm9ncmVzcy5saXN0Lmxlbmd0aC0xXVsndXJsJ11bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgJHZtLnVybDI9JHZtLnByb2dyZXNzLmxpc3RbJHZtLnByb2dyZXNzLmxpc3QubGVuZ3RoLTFdWyd1cmwnXVsxXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaW5zdGFsbCBpcyBkb25lJylcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBpbnN0YWxsTG9nKHJlc3BvbnNlLCR2bSl7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGZsYWc9MDtcclxuICAgICAgICAgICAgICAgIGlmKGRhdGEuc3RhdHVzPT0wKXtcclxuICAgICAgICAgICAgICAgICAgICAkdm0uaW5zdGFsbF9wcm9ncmVzcz0tMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgICAgICBpZigkdm0ucHJvZ3Jlc3MubGlzdC5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wO2k8JHZtLnByb2dyZXNzLmxpc3QubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtPSR2bS5wcm9ncmVzcy5saXN0W2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhICYmIGl0ZW0uc3RlcD09ZGF0YS5zdGVwICYmIGRhdGEuZG9uZT09MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdm0ucHJvZ3Jlc3MubGlzdC5zcGxpY2UoaSwgMSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnPTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIWZsYWcpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdm0ucHJvZ3Jlc3MubGlzdC5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkdm0uaW5zdGFsbF9wcm9ncmVzcz0kdm0ucHJvZ3Jlc3MubGlzdFskdm0ucHJvZ3Jlc3MubGlzdC5sZW5ndGgtMV0ucGVyY2VudDtcclxuICAgICAgICAgICAgICAgICAgICBsYXl1aS5lbGVtZW50LnByb2dyZXNzKCdpbnN0YWxsLXByb2dyZXNzJywgJHZtLmluc3RhbGxfcHJvZ3Jlc3MrJyUnKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICR2bS5wcm9ncmVzcy5saXN0LnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbW91bnRlZCgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFnZV9zdGVwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpIGluIHRoaXMucGFnZV9kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGFnZV9kYXRhW2ldICYmIHRoaXNbaV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbaV0gPSB0aGlzLnBhZ2VfZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMucGFnZV9zdGVwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgfSxcclxuICAgICAgICB3YXRjaDp7XHJcbiAgICAgICAgICAgICdkYi5wcmVmaXgnOntcclxuICAgICAgICAgICAgICAgaGFuZGxlcjpmdW5jdGlvbihuZXdWYWwsb2xkVmFsKXtcclxuICAgICAgICAgICAgICAgICAgIHRoaXMuZGIucHJlZml4ID0gIHRoaXMuZGIucHJlZml4LnJlcGxhY2UoL1teQS1aYS16XS9nLCcnKTtcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgZXhwb3J0cygnQGJhY2tlbmQuaW5zdGFsbCcsIGFwcCk7XHJcbn0pO1xyXG4iXX0=
