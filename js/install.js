layui.define(['jquery'], function (exports) {
  'use strict';

  var $ = layui.$;
  var app = new Vue({
    el: '#install',
    data: {
      // 环境监测 
      step: [{
        title: '环境检测',
        name: 'home'
      }, {
        title: '安全码验证',
        name: 'verify'
      }, {
        title: '环境选择',
        name: 'config'
      }, {
        title: '数据库配置',
        name: 'db'
      }, {
        title: '创建管理员',
        name: 'user'
      }, {
        title: '安装',
        name: 'install'
      }],
      requirements: window.vueData.requirements,
      dirs: window.vueData.dirs,
      page_step: window.vueData.step,
      page_data: window.vueData.data,
      status: 0,
      //0提交验证 1验证中 //2验证通过//3禁止
      current: 'home',
      install_progress: 0,
      tips: "",
      progress: {
        percent: 0,
        list: []
      },
      verify: {
        code: ''
      },
      config: {
        config: 'pro'
      },
      db: {
        type: 'MYSQL',
        dbname: '',
        dbusername: '',
        dbpwd: '',
        host: '',
        port: '',
        prefix: '',
        persistent: 0
      },
      user: {
        name: '',
        pwd: '',
        confirm_pwd: '',
        url: 'backend'
      },
      url1: '',
      url2: ''
    },
    methods: {
      verifyNext: function verifyNext() {
        var flag = 1;
        this.requirements.map(function (v) {
          if (!(v[1].pass | v[1].optional)) flag = 0;
        });
        this.dirs.map(function (v) {
          if (!(v[1].pass | v[1].optional)) flag = 0;
        });
        return flag;
      },
      go: function go(type) {
        if (!type) return;
        var $vm = this;
        $vm.tips = '';
        $vm.status = 0;
        $("input").removeClass("tips");

        for (var i = 0; i < $vm.step.length; i++) {
          if ($vm.step[i].name == $vm.current) {
            $vm.current = type == 'next' ? $vm.step[i + 1].name : $vm.step[i - 1].name;

            if ($vm.current == 'install') {
              $vm.doInstall();
            }

            return;
          }
        }
      },
      removeTips: function removeTips(name) {
        $("input." + name).removeClass("tips");
      },
      setup: function setup(name) {
        var $vm = this,
            api = "installer/setup",
            tips_arr = [];
        this.status = 1; // 本地检查input填写

        if (name == "db" || name == "user") {
          for (var i in $vm[name]) {
            if (!$vm[name][i] && i != "prefix" && i != "port" && i != "host" && i != "persistent") {
              tips_arr.push('input.' + i);
            }
          }

          while (tips_arr.length) {
            $(tips_arr.shift()).addClass('tips');

            if (tips_arr.length == 0) {
              $vm.status = 0;
              return;
            }
          }
        }

        if (name == 'verify') {
          api = 'installer/verify';
        }

        $.post(api, api == "installer/setup" ? {
          step: name,
          cfg: $vm[name]
        } : {
          step: name,
          code: $vm.verify.code
        }, function (data) {
          if (data && data.status) {
            $vm.status = 1;
            $vm.go('next');
          } else {
            $vm.current = data.step;
            $vm.tips = data.msg || 'tips';
            $vm.status = 0;
          }
        });
      },
      doInstall: function doInstall() {
        var $vm = this,
            response_len = false,
            data = null;
        $.get({
          url: 'installer/install',
          timeout: 3000000,
          dataType: 'text',
          xhrFields: {
            onprogress: function onprogress(e) {
              var response,
                  resp = e.currentTarget.response;

              if (response_len === false) {
                response = resp;
                response_len = resp.length;
              } else {
                response = resp.substring(response_len);
                response_len = resp.length;
              }

              var responses = response.replace(/\}\{/g, '}]-[{').split(']-[');
              responses.forEach(function (res) {
                $vm.installLog(res, $vm);
              });
            }
          }
        }, function (data) {
          $vm.url1 = $vm.progress.list[$vm.progress.list.length - 1]['url'][0];
          $vm.url2 = $vm.progress.list[$vm.progress.list.length - 1]['url'][1];
          console.log('install is done');
        });
      },
      installLog: function installLog(response, $vm) {
        var data = JSON.parse(response);
        var flag = 0;

        if (data.status == 0) {
          $vm.install_progress = -1;
        }

        if ($vm.progress.list.length) {
          for (var i = 0; i < $vm.progress.list.length; i++) {
            var item = $vm.progress.list[i];

            if (data && item.step == data.step && data.done == 1) {
              $vm.progress.list.splice(i, 1, data);
              flag = 1;
            }
          }

          if (!flag) {
            $vm.progress.list.push(data);
          }

          $vm.install_progress = $vm.progress.list[$vm.progress.list.length - 1].percent;
          layui.element.progress('install-progress', $vm.install_progress + '%');
        } else {
          $vm.progress.list.push(data);
        }
      }
    },
    mounted: function mounted() {
      if (this.page_step) {
        for (var i in this.page_data) {
          if (this.page_data[i] && this[i]) this[i] = this.page_data[i];
        }

        this.current = this.page_step;
      }
    },
    watch: {
      'db.prefix': {
        handler: function handler(newVal, oldVal) {
          this.db.prefix = this.db.prefix.replace(/[^A-Za-z]/g, '');
        }
      }
    }
  });
  exports('@backend.install', app);
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3RhbGwuanMiXSwibmFtZXMiOlsibGF5dWkiLCJkZWZpbmUiLCJleHBvcnRzIiwiJCIsImFwcCIsIlZ1ZSIsImVsIiwiZGF0YSIsInN0ZXAiLCJ0aXRsZSIsIm5hbWUiLCJyZXF1aXJlbWVudHMiLCJ3aW5kb3ciLCJ2dWVEYXRhIiwiZGlycyIsInBhZ2Vfc3RlcCIsInBhZ2VfZGF0YSIsInN0YXR1cyIsImN1cnJlbnQiLCJpbnN0YWxsX3Byb2dyZXNzIiwidGlwcyIsInByb2dyZXNzIiwicGVyY2VudCIsImxpc3QiLCJ2ZXJpZnkiLCJjb2RlIiwiY29uZmlnIiwiZGIiLCJ0eXBlIiwiZGJuYW1lIiwiZGJ1c2VybmFtZSIsImRicHdkIiwiaG9zdCIsInBvcnQiLCJwcmVmaXgiLCJwZXJzaXN0ZW50IiwidXNlciIsInB3ZCIsImNvbmZpcm1fcHdkIiwidXJsIiwidXJsMSIsInVybDIiLCJtZXRob2RzIiwidmVyaWZ5TmV4dCIsImxldCIsImZsYWciLCJtYXAiLCJ2IiwicGFzcyIsIm9wdGlvbmFsIiwiZ28iLCIkdm0iLCJyZW1vdmVDbGFzcyIsImkiLCJsZW5ndGgiLCJkb0luc3RhbGwiLCJyZW1vdmVUaXBzIiwic2V0dXAiLCJhcGkiLCJ0aXBzX2FyciIsInB1c2giLCJzaGlmdCIsImFkZENsYXNzIiwicG9zdCIsImNmZyIsIm1zZyIsInJlc3BvbnNlX2xlbiIsImdldCIsInRpbWVvdXQiLCJkYXRhVHlwZSIsInhockZpZWxkcyIsIm9ucHJvZ3Jlc3MiLCJlIiwicmVzcG9uc2UiLCJyZXNwIiwiY3VycmVudFRhcmdldCIsInN1YnN0cmluZyIsInJlc3BvbnNlcyIsInJlcGxhY2UiLCJzcGxpdCIsImZvckVhY2giLCJyZXMiLCJpbnN0YWxsTG9nIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJwYXJzZSIsIml0ZW0iLCJkb25lIiwic3BsaWNlIiwiZWxlbWVudCIsIm1vdW50ZWQiLCJ3YXRjaCIsImhhbmRsZXIiLCJuZXdWYWwiLCJvbGRWYWwiXSwibWFw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QUFFSCxLQTlMZTtBQStMaEI2RSxJQUFBQSxLQUFLLEVBQUM7QUFDRixtQkFBWTtBQUNUQyxRQUFBQSxPQUFPLEVBQUMsaUJBQVNDLE1BQVQsRUFBZ0JDLE1BQWhCLEVBQXVCO0FBQzNCLGVBQUtwRSxFQUFMLENBQVFPLE1BQVIsR0FBa0IsS0FBS1AsRUFBTCxDQUFRTyxNQUFSLENBQWU0QyxPQUFmLENBQXVCLFlBQXZCLEVBQW9DLEVBQXBDLENBQWxCO0FBQ0o7QUFIUztBQURWO0FBL0xVLEdBQVIsQ0FBWjtBQXdNQTVFLEVBQUFBLE9BQU8sQ0FBQyxrQkFBRCxFQUFxQkUsR0FBckIsQ0FBUEY7QUFDSCxDQTVNREYiLCJmaWxlIjoiaW5zdGFsbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImxheXVpLmRlZmluZShbJ2pxdWVyeSddLCAoZXhwb3J0cykgPT4ge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgY29uc3QgJCAgID0gbGF5dWkuJDtcclxuICAgIGNvbnN0IGFwcCA9IG5ldyBWdWUoe1xyXG4gICAgICAgIGVsICAgICA6ICcjaW5zdGFsbCcsXHJcbiAgICAgICAgZGF0YSAgIDoge1xyXG4gICAgICAgICAgICAvLyDnjq/looPnm5HmtYsgXHJcbiAgICAgICAgICAgIHN0ZXAgICAgICAgICAgICA6IFtcclxuICAgICAgICAgICAgICAgIHt0aXRsZTogJ+eOr+Wig+ajgOa1iycsIG5hbWU6ICdob21lJ30sXHJcbiAgICAgICAgICAgICAgICB7dGl0bGU6ICflronlhajnoIHpqozor4EnLCBuYW1lOiAndmVyaWZ5J30sXHJcbiAgICAgICAgICAgICAgICB7dGl0bGU6ICfnjq/looPpgInmi6knLCBuYW1lOiAnY29uZmlnJ30sXHJcbiAgICAgICAgICAgICAgICB7dGl0bGU6ICfmlbDmja7lupPphY3nva4nLCBuYW1lOiAnZGInfSxcclxuICAgICAgICAgICAgICAgIHt0aXRsZTogJ+WIm+W7uueuoeeQhuWRmCcsIG5hbWU6ICd1c2VyJ30sXHJcbiAgICAgICAgICAgICAgICB7dGl0bGU6ICflronoo4UnLCBuYW1lOiAnaW5zdGFsbCd9LFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICByZXF1aXJlbWVudHMgICAgOiB3aW5kb3cudnVlRGF0YS5yZXF1aXJlbWVudHMsXHJcbiAgICAgICAgICAgIGRpcnMgICAgICAgICAgICA6IHdpbmRvdy52dWVEYXRhLmRpcnMsXHJcbiAgICAgICAgICAgIHBhZ2Vfc3RlcCAgICAgICA6IHdpbmRvdy52dWVEYXRhLnN0ZXAsXHJcbiAgICAgICAgICAgIHBhZ2VfZGF0YSAgICAgICA6IHdpbmRvdy52dWVEYXRhLmRhdGEsXHJcbiAgICAgICAgICAgIHN0YXR1cyAgICAgICAgICA6IDAsLy8w5o+Q5Lqk6aqM6K+BIDHpqozor4HkuK0gLy8y6aqM6K+B6YCa6L+HLy8z56aB5q2iXHJcbiAgICAgICAgICAgIGN1cnJlbnQgICAgICAgICA6ICdob21lJyxcclxuICAgICAgICAgICAgaW5zdGFsbF9wcm9ncmVzczogMCxcclxuICAgICAgICAgICAgdGlwcyAgICAgICAgICAgIDogXCJcIixcclxuICAgICAgICAgICAgcHJvZ3Jlc3M6e1xyXG4gICAgICAgICAgICAgICAgcGVyY2VudDowLFxyXG4gICAgICAgICAgICAgICAgbGlzdDpbXSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdmVyaWZ5ICAgICAgICAgIDoge1xyXG4gICAgICAgICAgICAgICAgY29kZTogJycsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbmZpZyAgICAgICAgICA6IHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZzogJ3BybycsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRiICAgICAgICAgICAgICA6IHtcclxuICAgICAgICAgICAgICAgIHR5cGUgICAgICA6ICdNWVNRTCcsXHJcbiAgICAgICAgICAgICAgICBkYm5hbWUgICAgOiAnJyxcclxuICAgICAgICAgICAgICAgIGRidXNlcm5hbWU6ICcnLFxyXG4gICAgICAgICAgICAgICAgZGJwd2QgICAgIDogJycsXHJcbiAgICAgICAgICAgICAgICBob3N0ICAgICAgOiAnJyxcclxuICAgICAgICAgICAgICAgIHBvcnQgICAgICA6ICcnLFxyXG4gICAgICAgICAgICAgICAgcHJlZml4ICAgIDogJycsXHJcbiAgICAgICAgICAgICAgICBwZXJzaXN0ZW50OiAwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB1c2VyICAgICAgICAgICAgOiB7XHJcbiAgICAgICAgICAgICAgICBuYW1lICAgICAgIDogJycsXHJcbiAgICAgICAgICAgICAgICBwd2QgICAgICAgIDogJycsXHJcbiAgICAgICAgICAgICAgICBjb25maXJtX3B3ZDogJycsXHJcbiAgICAgICAgICAgICAgICB1cmwgICAgICAgIDogJ2JhY2tlbmQnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHVybDE6JycsXHJcbiAgICAgICAgICAgIHVybDI6JycsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgICAgIHZlcmlmeU5leHQoKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmxhZyA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlcXVpcmVtZW50cy5tYXAoZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh2WzFdLnBhc3MgfCB2WzFdLm9wdGlvbmFsKSkgZmxhZyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlycy5tYXAoZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh2WzFdLnBhc3MgfCB2WzFdLm9wdGlvbmFsKSkgZmxhZyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBmbGFnO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnbyh0eXBlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0eXBlKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0ICR2bSAgICA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAkdm0udGlwcyAgID0gJyc7XHJcbiAgICAgICAgICAgICAgICAkdm0uc3RhdHVzID0gMDtcclxuICAgICAgICAgICAgICAgICQoXCJpbnB1dFwiKS5yZW1vdmVDbGFzcyhcInRpcHNcIik7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICR2bS5zdGVwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCR2bS5zdGVwW2ldLm5hbWUgPT0gJHZtLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHZtLmN1cnJlbnQgPSB0eXBlID09ICduZXh0JyA/ICR2bS5zdGVwW2kgKyAxXS5uYW1lIDogJHZtLnN0ZXBbaSAtIDFdLm5hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZtLmN1cnJlbnQgPT0gJ2luc3RhbGwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdm0uZG9JbnN0YWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmVtb3ZlVGlwcyhuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiaW5wdXQuXCIgKyBuYW1lKS5yZW1vdmVDbGFzcyhcInRpcHNcIik7XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBzZXR1cChuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgJHZtICAgICA9IHRoaXMsIGFwaSA9IFwiaW5zdGFsbGVyL3NldHVwXCIsIHRpcHNfYXJyID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IDE7XHJcbiAgICAgICAgICAgICAgICAvLyDmnKzlnLDmo4Dmn6VpbnB1dOWhq+WGmVxyXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gXCJkYlwiIHx8IG5hbWUgPT0gXCJ1c2VyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluICR2bVtuYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR2bVtuYW1lXVtpXSAmJiBpIT1cInByZWZpeFwiICYmIGkgIT0gXCJwb3J0XCIgJiYgaSAhPSBcImhvc3RcIiAmJiBpICE9IFwicGVyc2lzdGVudFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXBzX2Fyci5wdXNoKCdpbnB1dC4nICsgaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRpcHNfYXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRpcHNfYXJyLnNoaWZ0KCkpLmFkZENsYXNzKCd0aXBzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aXBzX2Fyci5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZtLnN0YXR1cyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChuYW1lID09ICd2ZXJpZnknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXBpID0gJ2luc3RhbGxlci92ZXJpZnknO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJC5wb3N0KGFwaSwgYXBpID09IFwiaW5zdGFsbGVyL3NldHVwXCIgPyB7c3RlcDogbmFtZSwgY2ZnOiAkdm1bbmFtZV19IDoge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0ZXA6IG5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgY29kZTogJHZtLnZlcmlmeS5jb2RlXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR2bS5zdGF0dXMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdm0uZ28oJ25leHQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdm0uY3VycmVudCA9IGRhdGEuc3RlcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHZtLnRpcHMgICAgPSBkYXRhLm1zZyB8fCAndGlwcyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR2bS5zdGF0dXMgID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZG9JbnN0YWxsKCkge1xyXG4gICAgICAgICAgICAgICAgbGV0ICR2bSA9IHRoaXMsIHJlc3BvbnNlX2xlbiA9IGZhbHNlLCBkYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICQuZ2V0KHtcclxuICAgICAgICAgICAgICAgICAgICB1cmwgICAgICA6ICdpbnN0YWxsZXIvaW5zdGFsbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dCAgOiAzMDAwMDAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlIDogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHhockZpZWxkczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbnByb2dyZXNzOiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlLCByZXNwID0gZS5jdXJyZW50VGFyZ2V0LnJlc3BvbnNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlX2xlbiA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSAgICAgPSByZXNwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX2xlbiA9IHJlc3AubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSAgICAgPSByZXNwLnN1YnN0cmluZyhyZXNwb25zZV9sZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX2xlbiA9IHJlc3AubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlcyA9IHJlc3BvbnNlLnJlcGxhY2UoL1xcfVxcey9nLCd9XS1beycpLnNwbGl0KCddLVsnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMuZm9yRWFjaChyZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdm0uaW5zdGFsbExvZyhyZXMsJHZtKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAkdm0udXJsMT0kdm0ucHJvZ3Jlc3MubGlzdFskdm0ucHJvZ3Jlc3MubGlzdC5sZW5ndGgtMV1bJ3VybCddWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICR2bS51cmwyPSR2bS5wcm9ncmVzcy5saXN0WyR2bS5wcm9ncmVzcy5saXN0Lmxlbmd0aC0xXVsndXJsJ11bMV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2luc3RhbGwgaXMgZG9uZScpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaW5zdGFsbExvZyhyZXNwb25zZSwkdm0pe1xyXG4gICAgICAgICAgICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIGxldCBmbGFnPTA7XHJcbiAgICAgICAgICAgICAgICBpZihkYXRhLnN0YXR1cz09MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHZtLmluc3RhbGxfcHJvZ3Jlc3M9LTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgaWYoJHZtLnByb2dyZXNzLmxpc3QubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDtpPCR2bS5wcm9ncmVzcy5saXN0Lmxlbmd0aDtpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbT0kdm0ucHJvZ3Jlc3MubGlzdFtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YSAmJiBpdGVtLnN0ZXA9PWRhdGEuc3RlcCAmJiBkYXRhLmRvbmU9PTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZtLnByb2dyZXNzLmxpc3Quc3BsaWNlKGksIDEsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZz0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKCFmbGFnKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHZtLnByb2dyZXNzLmxpc3QucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHZtLmluc3RhbGxfcHJvZ3Jlc3M9JHZtLnByb2dyZXNzLmxpc3RbJHZtLnByb2dyZXNzLmxpc3QubGVuZ3RoLTFdLnBlcmNlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgbGF5dWkuZWxlbWVudC5wcm9ncmVzcygnaW5zdGFsbC1wcm9ncmVzcycsICR2bS5pbnN0YWxsX3Byb2dyZXNzKyclJyk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAkdm0ucHJvZ3Jlc3MubGlzdC5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIG1vdW50ZWQoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhZ2Vfc3RlcCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLnBhZ2VfZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhZ2VfZGF0YVtpXSAmJiB0aGlzW2ldKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2ldID0gdGhpcy5wYWdlX2RhdGFbaV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLnBhZ2Vfc3RlcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgd2F0Y2g6e1xyXG4gICAgICAgICAgICAnZGIucHJlZml4Jzp7XHJcbiAgICAgICAgICAgICAgIGhhbmRsZXI6ZnVuY3Rpb24obmV3VmFsLG9sZFZhbCl7XHJcbiAgICAgICAgICAgICAgICAgICB0aGlzLmRiLnByZWZpeCA9ICB0aGlzLmRiLnByZWZpeC5yZXBsYWNlKC9bXkEtWmEtel0vZywnJyk7XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGV4cG9ydHMoJ0BiYWNrZW5kLmluc3RhbGwnLCBhcHApO1xyXG59KTtcclxuIl19
